<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FNN ART - المعرض</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
<link href="https://api.mapbox.com/mapbox-gl-js/v3.7.0/mapbox-gl.css" rel="stylesheet" />
<style>
  :root{
    --bg:#fff;
    --text-main:#222;
    --accent:#111;
    --muted:#666;
    --card-radius:32px;
    --btn-radius:30px;
    --side-nav-height:520px;
    --side-nav-offset:34px;
  }

  *,*::before,*::after{ box-sizing:border-box; -webkit-font-smoothing:antialiased; }
  [hidden]{ display:none !important; }
  body{
    margin:0; height:100vh; width:100vw;
    background:#fff; color:var(--text-main);
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .layout{
    display:flex;
    height:100vh;
    width:100vw;
    max-width:none;
    gap:0;
    position:relative;
    overflow:hidden;
    align-items:stretch;
  }

  .home-split{
    display:flex;
    width:100%;
    height:100%;
    align-items:stretch;
    overflow:hidden;
  }
  .home-split-left,
  .home-split-right{
    min-width:0;
    height:100%;
  }
  .home-split-left{
    flex:1 1 50%;
  }
  .home-split-right{
    flex:1 1 100%;
    width:100%;
    display:flex;
    align-items:stretch;
    justify-content:stretch;
    background:#000;
  }
  .sutroFrame{
    width:100%;
    height:100%;
    border:0;
    display:block;
  }

  #map{
    width:100%;
    height:100%;
  }

  .fnn3dFrame{
    width:100%;
    height:100%;
    border:0;
    display:block;
  }

  .mapboxgl-canvas{ outline:none; filter:none; }

  /* ===== 3D POPUP OVER MAP (fixed box, model rotates inside) ===== */
  .map-3d-popup{
    position:absolute;
    left:50%;
    top:50%;
    /* ✅ up by 50% of its size + left by 20% of its size */
    transform:translate(-70%, -100%);
    width:50%;
    aspect-ratio:1/1;
    max-width:560px;
    min-width:240px;
    border-radius:24px;
    overflow:hidden;
    z-index:60;
    background:rgba(255,255,255,0.10);
    border:1px solid rgba(255,255,255,0.18);
    box-shadow:0 30px 80px rgba(0,0,0,0.40);
    backdrop-filter:blur(18px);
    -webkit-backdrop-filter:blur(18px);
    opacity:0;
    visibility:hidden;
    pointer-events:none;
    touch-action:none;
    transition:opacity .25s ease;
  }
  .map-3d-popup.show{
    opacity:1;
    visibility:visible;
    pointer-events:auto;
  }
  .map-3d-inner{
    width:100%;
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    background:transparent;
  }
  .map-3d-inner model-viewer{
    width:100%;
    height:100%;
    background:transparent;
    touch-action:manipulation;
    pointer-events:auto;
  }

  .side-nav{
    position:absolute;
    top:0;
    left:0;
    right:auto;
    bottom:0;
    transform:none;
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    z-index:20;
    background:rgba(0,0,0,0.5);
    backdrop-filter:blur(15px);
    -webkit-backdrop-filter:blur(15px);
    border-radius:0;
    border:1px solid rgba(255,255,255,0.15);
    box-shadow:0 10px 26px rgba(0,0,0,0.3);
    transition:background 0.3s, border-color 0.3s;
    height:100%;
    max-height:100%;
    overflow:auto;
    pointer-events:auto;
    padding:0;
  }
  .side-nav.focused{
    background:rgba(0,0,0,0.75);
    border-color:rgba(255,255,255,0.1);
  }
  .nav-item{
    padding:22px 40px;
    color:rgba(255,255,255,0.8);
    font-weight:600; font-size:14px;
    text-transform:uppercase; letter-spacing:0.05em;
    border-bottom:1px solid rgba(255,255,255,0.1);
    transition:all 0.3s ease;
    cursor:pointer; text-align:center;
    text-shadow:0 2px 10px rgba(0,0,0,0.5);
    user-select:none;
  }
  .side-nav .nav-item{
    flex:none;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:10px 16px;
    font-size:12px;
  }
  .nav-item:last-child{ border-bottom:none; }
  .nav-item:hover,
  .nav-item.active{
    background:rgba(255,255,255,0.2);
    color:#fff;
    padding-right:50px;
  }
  .side-nav .nav-item:hover,
  .side-nav .nav-item.active{
    border-radius:10px;
    padding-right:16px;
    padding-left:16px;
  }

  .mobile-nav{
    display:none;
    position:absolute;
    left:12px;
    right:12px;
    transform:none;
    bottom:40px;
    z-index:30;
    background:rgba(0,0,0,0.55);
    backdrop-filter:blur(16px); -webkit-backdrop-filter:blur(16px);
    border:1px solid rgba(255,255,255,0.10);
    box-shadow:0 12px 26px rgba(0,0,0,0.35);
    border-radius:999px;
    padding:6px;
    gap:4px;
    width:auto;
    max-width:720px;
    margin:0 auto;
    overflow:hidden;
    pointer-events:auto;
  }
  .mobile-nav .nav-item{
    border:none;
    padding:10px 6px;
    border-radius:12px;
    font-size:10px;
    letter-spacing:0.05em;
    line-height:1.1;
    white-space:normal;
    background:transparent;
    flex:1;
    min-width:0;
  }
  .mobile-nav .nav-item:hover,
  .mobile-nav .nav-item.active{
    padding:10px 6px;
    background:rgba(255,255,255,0.14);
  }

  .shop{
    flex:1 1 auto;
    width:100%;
    display:flex;
    flex-direction:column;
    height:100%;
    min-height:0;
    background:#fff;
    position:relative;
    z-index:5;
    box-shadow:0 26px 60px rgba(0,0,0,0.10);
    overflow:hidden; /* ✅ prevent right overflow */
    border-radius:0;
  }

  .app-section{
    position:absolute; inset:0;
    display:flex; flex-direction:column;
    background:#fff;
    opacity:0; visibility:hidden; pointer-events:none;
    transform:translateY(18px);
    transition:opacity .35s ease, transform .35s ease;
    z-index:1;
    overflow:hidden;
  }
  .app-section.active-section{
    opacity:1; visibility:visible; pointer-events:auto;
    transform:translateY(0); z-index:10;
  }

  .section-scroll{
    height:100%;
    overflow-y:auto;
    padding:40px;
  }

  .section-scroll, .shop-body{
    -ms-overflow-style:auto;
    scrollbar-width:auto;
  }
  .section-scroll::-webkit-scrollbar, .shop-body::-webkit-scrollbar{ width:10px; height:10px; }
  .section-scroll::-webkit-scrollbar-thumb, .shop-body::-webkit-scrollbar-thumb{
    background:rgba(0,0,0,.22);
    border-radius:999px;
  }
  .section-scroll::-webkit-scrollbar-track, .shop-body::-webkit-scrollbar-track{ background:transparent; }

  h1.sec-title{ font-size:34px; font-weight:900; margin:0 0 12px; letter-spacing:-0.02em; color:#111; }
  p.sec-sub{ font-size:16px; color:var(--muted); line-height:1.7; margin:0 0 24px; width:100%; }

  /* =========================================================
     HOME - matches screenshot layout
     - No scroll needed
     - Logo/top area + 2-column main (copy left, image right)
     - Left copy + CTA
     ========================================================= */
  #sect-home .section-scroll{
    padding:24px 0;
    overflow:hidden;
    height:100%;
  }

  .display-layout{
    height:100%;
    display:flex;
    flex-direction:column;
    gap:18px;
    min-height:0;
  }
  .display-head{
    text-align:center;
    padding:0 32px;
  }
  .display-head h1{
    margin:0;
    font-size:34px;
    font-weight:800;
    color:#111;
  }
  .display-frame{
    flex:1 1 auto;
    width:100%;
    height:100%;
    min-height:100vh;
    background:#fff;
    display:flex;
    flex-direction:column;
    position:relative;
    overflow:hidden;
    gap:0;
    padding:0;
  }
  .frame-top-bar,
  .frame-bottom-bar{
    flex:0 0 10vh;
    height:10vh;
    width:100%;
    background:#fff;
  }
  .frame-split{
    display:flex;
    flex-direction:row;
    direction:ltr;
    width:100%;
    flex:0 0 80vh;
    height:80vh;
    min-height:0;
    position:relative;
    border-top:2px solid #000;
    border-bottom:2px solid #000;
  }
  .frame-left,
  .frame-right{
    flex:0 0 50%;
    width:50%;
    height:100%;
    min-width:0;
  }
  .frame-left{
    order:1;
    overflow:hidden;
  }
  .frame-right{
    order:2;
    position:relative;
    overflow:hidden;
    background:#fff;
    display:flex;
    flex-direction:column;
  }
  .map-panel{
    position:absolute;
    inset:0;
    background:#111;
    z-index:1;
    display:none;
  }
  .map-kaaba-box{
    position:absolute;
    top:14px;
    left:14px;
    width:120px;
    height:120px;
    display:flex;
    align-items:center;
    justify-content:center;
    background:rgba(0,0,0,0.55);
    border:1px solid rgba(255,255,255,0.2);
    border-radius:14px;
    box-shadow:0 16px 30px rgba(0,0,0,0.45);
    backdrop-filter:blur(6px);
    z-index:6;
    pointer-events:none;
    perspective:600px;
  }
  .kaaba-cube{
    width:64px;
    height:64px;
    position:relative;
    transform-style:preserve-3d;
    animation:kaabaSpin 18s linear infinite;
  }
  .kaaba-face{
    position:absolute;
    width:64px;
    height:64px;
    background:#0b0b0b;
    border:1px solid rgba(255,255,255,0.1);
    background-image:linear-gradient(to bottom, rgba(0,0,0,0) 0 44%, #d4af37 44% 56%, rgba(0,0,0,0) 56% 100%);
  }
  .kaaba-face.front{ transform:translateZ(32px); }
  .kaaba-face.back{ transform:rotateY(180deg) translateZ(32px); }
  .kaaba-face.right{ transform:rotateY(90deg) translateZ(32px); }
  .kaaba-face.left{ transform:rotateY(-90deg) translateZ(32px); }
  .kaaba-face.top{
    transform:rotateX(90deg) translateZ(32px);
    background:#111;
    background-image:none;
  }
  .kaaba-face.bottom{
    transform:rotateX(-90deg) translateZ(32px);
    background:#070707;
    background-image:none;
  }
  @keyframes kaabaSpin{
    from{ transform:rotateX(12deg) rotateY(0deg); }
    to{ transform:rotateX(12deg) rotateY(360deg); }
  }
  .kaaba-panel{
    position:absolute;
    inset:0;
    background:#00050a;
    z-index:2;
    display:none;
  }
  .frame-right.show-map .map-panel{
    display:block;
  }
  .frame-right.show-map .shop{
    display:none;
  }
  .frame-right.show-kaaba .kaaba-panel{
    display:block;
  }
  .frame-right.show-kaaba .shop{
    display:none;
  }
  .frame-right.show-kaaba .map-panel{
    display:none;
  }
  .display-table-wrap{
    flex:0 0 auto;
    padding:0 32px 24px;
  }
  .display-table{
    width:100%;
    border-collapse:collapse;
    font-size:14px;
    background:#fff;
  }
  .display-table th,
  .display-table td{
    border:1px solid rgba(0,0,0,0.25);
    padding:10px 12px;
    text-align:right;
    white-space:normal;
  }
  .display-table th{
    background:#fafafa;
    font-weight:700;
  }

  .home-screen{
    --home-pad-left:52px;
    --home-pad-right:52px;
    height:100%;
    padding:38px var(--home-pad-right) var(--side-nav-offset) var(--home-pad-left);
    display:flex;
    flex-direction:column;
    gap:16px;
    overflow:hidden;
    justify-content:flex-start;
    position:relative;
    background:#fff;
  }
  .home-screen::after{ display:none; }

  .home-top{
    flex:0 0 auto;
    display:flex;
    flex-direction:column;
    --home-logo-width:min(900px, 92%);
    align-items:center;
    gap:6px;
    position:relative;
    z-index:1;
    text-align:center;
  }

  .home-top small{
    color:#9a9a9a;
    font-weight:600;
    font-size:20px;
    letter-spacing:0.02em;
    width:var(--home-logo-width);
    text-align:left;
    padding-left:5%;
    box-sizing:border-box;
  }

  .home-logo{
    width:var(--home-logo-width);
    height:auto;
    display:block;
    object-fit:contain;
    margin:0 auto;
  }

  .home-tagline{
    font-size:16px;
    letter-spacing:0.5em;
    text-transform:uppercase;
    font-weight:700;
    color:#6f6f6f;
    width:var(--home-logo-width);
    margin:0 auto;
    text-align:center;
  }

  .home-main{
    flex:1;
    min-height:0;
    display:grid;
    grid-template-columns:1fr;
    grid-template-rows:1fr;
    gap:0;
    align-items:stretch;
    align-content:stretch;
    justify-items:stretch;
    margin-top:auto;
    margin-left:calc(-1 * var(--home-pad-left));
    margin-right:calc(-1 * var(--home-pad-right));
    width:calc(100% + var(--home-pad-left) + var(--home-pad-right));
    position:relative;
    z-index:1;
    border-radius:0;
    overflow:hidden;
  }

  .home-banner{
    position:absolute;
    top:0;
    bottom:0;
    left:0;
    width:min(38%, 440px);
    background:#f2f2f2;
    background:linear-gradient(90deg, rgba(242,242,242,0.98) 0%, rgba(242,242,242,0.96) 55%, rgba(242,242,242,0.0) 100%);
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    gap:14px;
    padding:28px 26px;
    height:100%;
    z-index:2;
  }
  .home-banner-title{
    margin:0;
    font-size:28px;
    font-weight:800;
    line-height:1.2;
    color:#111;
    text-align:center;
  }
  .home-banner-title span{ display:block; }
  .home-banner-btn{
    border:1px solid #e64a4a;
    background:#e64a4a;
    color:#fff;
    font-weight:700;
    font-size:21px;
    padding:13px 24px;
    border-radius:999px;
    cursor:pointer;
  }

  /* Home copy block */
  .home-copy{
    align-self:end;
    justify-self:start;
    margin:0 0 0 calc(-1 * var(--home-pad-left));
    width:fit-content;
    max-width:100%;
    display:flex;
    align-items:flex-end;
  }
  .home-glass{
    width:fit-content;
    max-width:100%;
    height:var(--side-nav-height);
    min-height:var(--side-nav-height);
    max-height:var(--side-nav-height);
    --home-glass-pad-x:34px;
    padding:30px var(--home-glass-pad-x);
    border-radius:0 22px 22px 0;
    background:rgba(240,240,240,0.78);
    border:1px solid rgba(255,255,255,0.9);
    box-shadow:0 18px 32px rgba(0,0,0,0.08);
    backdrop-filter:blur(12px);
    -webkit-backdrop-filter:blur(12px);
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    gap:18px;
  }
  .home-copy-title{
    margin:0;
    font-size:42px;
    font-weight:700;
    color:#5f5f5f;
    letter-spacing:0.02em;
    line-height:1.4;
  }
  .home-copy-title span{ display:block; text-align:center; }

  .btn-home{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding:14px 28px;
    border-radius:999px;
    border:1px solid rgba(228,144,144,0.7);
    cursor:pointer;
    font-weight:700;
    font-size:13px;
    letter-spacing:0.06em;
    text-transform:none;
    color:#7b4b4b;
    background:rgba(228,144,144,0.28);
    box-shadow:0 8px 14px rgba(0,0,0,0.08);
    white-space:nowrap;
  }
  .btn-home:hover{ background:rgba(228,144,144,0.38); }

  .home-illustration-wrap{
    width:100%;
    height:100%;
    min-height:0;
    display:flex;
    align-items:stretch;
    justify-content:flex-start;
    overflow:hidden;
    padding:0;
    align-self:center;
    justify-self:center;
    position:relative;
  }

  .home-slider-controls{
    position:absolute;
    left:18px;
    right:18px;
    bottom:14px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    z-index:3;
    pointer-events:auto;
  }
  .home-slider-dots{
    display:flex;
    gap:10px;
    pointer-events:auto;
  }
  .home-dot{
    width:8px;
    height:8px;
    border-radius:999px;
    border:none;
    background:rgba(0,0,0,0.25);
    cursor:pointer;
    padding:0;
  }
  .home-dot.active{
    width:22px;
    background:rgba(0,0,0,0.6);
  }
  .home-slider-arrows{
    display:flex;
    gap:12px;
    pointer-events:auto;
  }
  .home-arrow{
    border:none;
    background:transparent;
    color:rgba(0,0,0,0.45);
    font-size:18px;
    line-height:1;
    cursor:pointer;
    padding:0;
  }
  .home-arrow:hover{ color:rgba(0,0,0,0.75); }

  .home-illustration-track{
    width:100%;
    height:100%;
    display:flex;
    align-items:stretch;
    gap:0;
    overflow-x:auto;
    overflow-y:hidden;
    scroll-snap-type:x mandatory;
    scroll-padding-left:0;
    padding:0;
    -webkit-overflow-scrolling:touch;
  }
  .home-illustration-track::-webkit-scrollbar{ display:none; }
  .home-illustration-track{ scrollbar-width:none; }

  .home-slide{
    flex:0 0 100%;
    height:100%;
    min-height:100%;
    background:transparent;
    border-radius:0;
    display:flex;
    align-items:stretch;
    justify-content:stretch;
    padding:0;
    box-shadow:none;
    overflow:hidden;
    scroll-snap-align:start;
  }
  .home-slide-media{
    width:100%;
    height:100%;
    min-height:100%;
    display:flex;
    align-items:stretch;
    justify-content:stretch;
    padding-left:0;
  }
  /* ✅ no hover on second image + fit screen */
  .home-illustration{
    width:100%;
    height:100%;
    object-fit:cover;
    object-position:center center;
    display:block;
    transition:none !important;
    transform:none !important;
    filter:none;
    margin:0;
    border-radius:0;
    background:transparent;
  }

  /* ===== ABOUT (matches screenshot card layout) ===== */
  #sect-about{ background:#fff; }
  #sect-about .section-scroll{
    background:#fff;
    padding:48px 48px 64px;
  }
  #sect-about .sec-title{ font-size:42px; margin-bottom:12px; letter-spacing:-0.01em; }
  .about-wrap{ max-width:1100px; margin:0 auto; }
  .about-lead{
    font-family:"Inter", system-ui, -apple-system, "Segoe UI", Arial, sans-serif;
    font-size:20px;
    line-height:1.7;
    color:#3d3d3d;
    font-weight:600;
    margin:0 0 14px;
    max-width:980px;
  }
  .about-sublead{
    display:block;
    font-family:"Inter", system-ui, -apple-system, "Segoe UI", Arial, sans-serif;
    font-size:15px;
    line-height:1.7;
    color:#6a6a6a;
    font-weight:400;
    margin:0 0 26px;
    max-width:1000px;
  }

  .about-grid{
    display:grid;
    grid-template-columns:repeat(3, minmax(0, 1fr));
    gap:26px;
    margin-top:18px;
  }

  .about-card{
    background:#fff;
    border:1px solid #f0f0f0;
    border-radius:26px;
    padding:20px;
    box-shadow:0 18px 36px rgba(0,0,0,0.08);
    display:flex;
    flex-direction:column;
    min-height:360px;
  }

  .about-card-media{
    width:100%;
    height:128px;
    border-radius:20px;
    overflow:hidden;
    background:#ededed;
    border:1px solid #f1f1f1;
    position:relative;
  }
  .about-card-media::before{
    content:"";
    position:absolute;
    top:12px;
    left:12px;
    width:84px;
    height:12px;
    border-radius:999px;
    background:rgba(0,0,0,0.08);
    z-index:2;
  }
  .about-card-media img{
    width:100%;
    height:100%;
    object-fit:cover;
    filter:none;
  }

  .about-card-meta{
    margin:16px 0 6px;
    font-size:10px;
    font-weight:800;
    letter-spacing:0.12em;
    text-transform:uppercase;
    color:#9b9b9b;
  }
  .about-card-title{
    margin:0 0 8px;
    font-size:18px;
    font-weight:800;
    letter-spacing:-0.01em;
    color:#111;
    line-height:1.3;
  }
  .about-card-desc{
    margin:0;
    font-size:13px;
    line-height:1.7;
    color:#6a6a6a;
  }

  /* ===== GALLERY ===== */
  #sect-gallery{ padding:0; }
  .shop-head{
    flex-shrink:0;
    position:sticky; top:0;
    background:rgba(255,255,255,0.96);
    backdrop-filter:blur(10px);
    z-index:12;
    padding:22px 30px;
    border-bottom:1px solid #f0f0f0;
  }

  .nav-group{
    display:flex; gap:10px; align-items:center;
    flex-wrap:nowrap;
    overflow-x:auto;
    scrollbar-width:none;
  }
  .nav-group::-webkit-scrollbar{ display:none; }
  .chip{
    border:none;
    background:transparent;
    font-size:14px;
    color:#999;
    cursor:pointer;
    padding:8px 12px;
    transition:all .2s;
    font-weight:600;
    white-space:nowrap;
    border-radius:999px;
  }
  .chip:hover{ color:#333; }
  .chip.active{
    background:var(--accent);
    color:#fff;
    padding:8px 22px;
  }

  .shop-body{
    padding:22px 30px 70px;
    flex-grow:1;
    overflow-y:auto;
    min-height:0;
  }

  .grid{
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(220px, 1fr));
    gap:26px;
    width:100%;
  }
  .card{
    background:#fff;
    border:1px solid #f3f3f3;
    border-radius:28px;
    padding:26px 18px;
    cursor:pointer;
    transition:transform .25s ease, box-shadow .25s ease;
    display:flex;
    flex-direction:column;
    align-items:center;
    text-align:center;
  }
  .card:hover{ transform:translateY(-6px); box-shadow:0 18px 42px rgba(0,0,0,0.07); }
  .card-media{
    width:100%;
    height:180px;
    display:flex;
    align-items:flex-end;
    justify-content:center;
    margin-bottom:16px;
  }
  .card-media img{ max-width:100%; max-height:100%; object-fit:contain; filter:none; }
  .card-name{ font-size:12px; font-weight:900; letter-spacing:0.10em; color:#b0b0b0; text-transform:uppercase; margin-bottom:6px; }
  .card-sub{ font-size:10px; color:#d0d0d0; text-transform:uppercase; letter-spacing:0.06em; }

  .solo-wrap{ display:none; }
  #sect-gallery.solo .grid{ display:none; }
  #sect-gallery.solo .shop-body{ background:#fff; }
  #sect-gallery.solo .solo-wrap{
    display:block;
    padding:0;
  }
  #sect-gallery.solo .solo-frame{
    position:relative;
    overflow:hidden;
    background:#f3f3f3;
    border-radius:28px;
    padding:0;
    border:1px solid #ececec;
    box-shadow:0 18px 40px rgba(0,0,0,0.06);
    display:flex;
    flex-direction:column;
  }
  #sect-gallery.solo .solo-frame-head{
    position:absolute;
    top:18px;
    left:22px;
    right:22px;
    z-index:10;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:16px;
    pointer-events:none;
  }

  .back-nav{ margin:4px 0 12px; }
  .btn-back{
    background:none; border:none; padding:0;
    color:#9a9a9a; font-size:13px; font-weight:700;
    cursor:pointer; display:inline-flex; align-items:center; gap:8px;
  }

  .solo-name{
    margin:0;
    font-size:20px;
    font-weight:900;
    letter-spacing:-0.02em;
    color:#111;
  }

  .solo-tabs-bar{
    width:100%;
    display:flex;
    justify-content:center;
    margin:0;
    padding:12px 22px 18px;
    pointer-events:auto;
  }

  .solo-media-container{
    width:100%;
    aspect-ratio:16 / 9;
    background:transparent;
    border-radius:0;
    overflow:hidden;
    position:relative;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow:none;
    border:none;
  }
  .solo-media-container img,
  .solo-media-container video{
    width:100%;
    height:100%;
    object-fit:cover;
    object-position:center;
  }
  .solo-media-container img{ filter:none; }
  model-viewer{ width:100%; height:100%; }

  .media-tabs{
    display:flex;
    gap:8px;
    padding:8px;
    border-radius:999px;
    background:#bdbdbd;
    backdrop-filter:none; -webkit-backdrop-filter:none;
  }
  .media-tab{
    border:none;
    cursor:pointer;
    padding:10px 18px;
    border-radius:999px;
    font-weight:900;
    letter-spacing:0.06em;
    text-transform:uppercase;
    font-size:11px;
    color:rgba(255,255,255,0.85);
    background:rgba(255,255,255,0.18);
    transition:all .2s ease;
    white-space:nowrap;
  }
  .media-tab.active{
    background:#fff;
    color:#111;
  }

  .solo-bottom-tabs{ pointer-events:auto; }
  .solo-bottom-tabs-inner{
    display:flex;
    gap:8px;
    padding:8px;
    border-radius:999px;
    background:#bdbdbd;
  }
  .solo-bottom-tab{
    border:none;
    cursor:pointer;
    padding:10px 18px;
    border-radius:999px;
    font-weight:900;
    letter-spacing:0.06em;
    text-transform:uppercase;
    font-size:11px;
    color:rgba(255,255,255,0.90);
    background:rgba(255,255,255,0.18);
    transition:all .2s ease;
    white-space:nowrap;
  }
  .solo-bottom-tab.active{
    background:#fff;
    color:#111;
  }

  .solo-frame-foot{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:16px;
    padding:16px 22px;
    background:#fff;
    border-top:1px solid #e9e9e9;
  }
  .solo-foot-left{ min-width:0; }
  .solo-foot-title{
    font-size:11px;
    font-weight:950;
    letter-spacing:0.14em;
    text-transform:uppercase;
    color:#111;
    margin-bottom:6px;
  }
  .solo-foot-desc{
    font-size:12px;
    line-height:1.6;
    color:#9a9a9a;
    max-width:360px;
  }
  .solo-foot-right{
    display:flex;
    flex-direction:column;
    align-items:flex-end;
    gap:10px;
  }
  .solo-tab-wrap{
    position:relative;
    display:flex;
  }
  .solo-tab-wrap .solo-bottom-tab{ width:100%; }
  .solo-popover{
    position:absolute;
    left:50%;
    bottom:calc(100% + 10px);
    transform:translateX(-50%);
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    gap:10px;
    padding:10px;
    border-radius:22px;
    background:rgba(0,0,0,0.06);
    box-shadow:0 18px 42px rgba(0,0,0,0.14);
    z-index:18;
    pointer-events:auto;
    max-width:min(420px, calc(100vw - 44px));
  }
  .solo-suboption{
    border:none;
    cursor:pointer;
    padding:14px 18px;
    border-radius:999px;
    font-weight:950;
    letter-spacing:0.08em;
    text-transform:uppercase;
    font-size:12px;
    color:#111;
    background:rgba(255,255,255,0.92);
    transition:all .18s ease;
  }
  .solo-suboption.active{
    background:#111;
    color:#fff;
  }

  .solo-config{
    position:absolute;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%) translateY(12px);
    width:340px;
    max-width:calc(100% - 44px);
    padding:16px 16px 14px;
    border-radius:20px;
    background:rgba(255,255,255,0.78);
    border:1px solid rgba(255,255,255,0.72);
    box-shadow:0 22px 46px rgba(0,0,0,0.14);
    backdrop-filter:blur(16px);
    -webkit-backdrop-filter:blur(16px);
    opacity:0;
    pointer-events:none;
    transition:opacity .18s ease, transform .22s ease;
    z-index:19;
  }
  #sect-gallery.solo .solo-frame.customize-open .solo-config{
    opacity:1;
    pointer-events:auto;
    transform:translate(-50%,-50%) translateY(0);
  }
  .solo-config-close{
    position:absolute;
    top:10px;
    right:10px;
    width:32px;
    height:32px;
    border:none;
    border-radius:12px;
    background:rgba(0,0,0,0.06);
    color:#111;
    cursor:pointer;
    font-weight:950;
    font-size:18px;
    line-height:1;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .solo-config-title{
    margin:2px 34px 12px 0;
    font-size:13px;
    font-weight:950;
    letter-spacing:0.10em;
    text-transform:uppercase;
    color:#111;
  }
  .solo-config-group{ margin-bottom:12px; }
  .solo-config-label{
    font-size:10px;
    font-weight:950;
    letter-spacing:0.10em;
    text-transform:uppercase;
    color:rgba(0,0,0,0.45);
    margin-bottom:8px;
  }
  .solo-config-options{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
  }
  .solo-config-option{
    border:none;
    cursor:pointer;
    padding:10px 12px;
    border-radius:999px;
    font-weight:900;
    font-size:12px;
    color:#111;
    background:rgba(255,255,255,0.82);
    border:1px solid rgba(0,0,0,0.08);
    transition:all .18s ease;
  }
  .solo-config-option.active{
    background:#111;
    border-color:#111;
    color:#fff;
  }
  .solo-config-summary{
    font-size:12px;
    color:rgba(0,0,0,0.70);
    margin-top:6px;
  }

  .solo-info-card{
    position:absolute;
    left:22px;
    top:50%;
    transform:translateY(-50%) translateX(-12px);
    width:260px;
    max-width:calc(100% - 44px);
    padding:16px 16px 14px;
    border-radius:18px;
    background:rgba(255,255,255,0.70);
    border:1px solid rgba(255,255,255,0.72);
    box-shadow:0 22px 46px rgba(0,0,0,0.12);
    backdrop-filter:blur(16px);
    -webkit-backdrop-filter:blur(16px);
    opacity:0;
    pointer-events:none;
    transition:opacity .18s ease, transform .22s ease;
    z-index:20;
  }
  #sect-gallery.solo .solo-frame.info-open .solo-info-card{
    opacity:1;
    pointer-events:auto;
    transform:translateY(-50%) translateX(0);
  }
  .solo-info-close{
    position:absolute;
    top:10px;
    right:10px;
    width:32px;
    height:32px;
    border:none;
    border-radius:12px;
    background:rgba(0,0,0,0.06);
    color:#111;
    cursor:pointer;
    font-weight:950;
    font-size:18px;
    line-height:1;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .solo-info-title{
    margin:2px 34px 10px 0;
    font-size:14px;
    font-weight:950;
    letter-spacing:0.06em;
    text-transform:uppercase;
    color:#111;
  }
  .solo-info-text{
    font-size:12px;
    line-height:1.7;
    color:rgba(0,0,0,0.70);
    margin-bottom:12px;
  }
  .solo-info-meta{
    display:grid;
    gap:10px;
  }
  .solo-meta-item span{
    display:block;
    font-size:10px;
    font-weight:900;
    letter-spacing:0.08em;
    text-transform:uppercase;
    color:rgba(0,0,0,0.45);
    margin-bottom:4px;
  }
  .solo-meta-item strong{
    display:block;
    font-size:13px;
    font-weight:950;
    color:#111;
  }

  .img-arrow{
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    width:44px;
    height:44px;
    border:none; border-radius:999px;
    background:#cfcfcf;
    color:#666;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:18px;
    backdrop-filter:none;
    z-index:9;
  }
  .img-arrow.left{ left:16px; }
  .img-arrow.right{ right:16px; }

  .v360-ui{
    position:absolute;
    left:50%; transform:translateX(-50%);
    bottom:12px;
    width:min(370px, 78%);
    background:rgba(0,0,0,0.35);
    backdrop-filter:blur(12px);
    border-radius:999px;
    padding:5px 7px;
    display:flex; gap:6px; align-items:center;
  }
  .v360-btn{
    width:22px; height:18px;
    border:none; border-radius:8px;
    background:rgba(255,255,255,0.18);
    color:#fff;
    cursor:pointer;
    font-weight:900;
    font-size:11px;
  }
  .v360-range{
    flex:1;
    -webkit-appearance:none;
    appearance:none;
    height:5px;
    border-radius:999px;
    background:rgba(255,255,255,0.22);
    outline:none;
  }
  .v360-range::-webkit-slider-thumb{
    -webkit-appearance:none;
    appearance:none;
    width:27px; height:11px;
    border-radius:999px;
    background:#fff;
    cursor:pointer;
    box-shadow:0 5px 9px rgba(0,0,0,0.18);
  }

  .solo-info-block{
    padding:18px 0 0;
    border-top:1px solid #e9e9e9;
  }
  .solo-desc{
    text-align:left;
    color:#666;
    font-size:13px;
    line-height:1.7;
    border-top:none;
    padding-top:0;
    margin-bottom:18px;
  }
  .solo-desc strong{
    display:block;
    font-size:12px;
    letter-spacing:0.14em;
    text-transform:uppercase;
    color:#666;
    margin:0 0 6px;
  }
  .data-row{ display:flex; flex-wrap:wrap; gap:38px; margin-top:14px; }
  .data-item span:first-child{
    display:block; font-size:10px; color:#999; text-transform:uppercase;
    font-weight:900; margin-bottom:4px; letter-spacing:0.08em;
  }
  .data-item span:last-child{ font-size:14px; font-weight:900; color:#222; }

  .artist-profile{
    display:flex; align-items:center; gap:14px;
    margin-top:18px;
    padding:16px;
    background:#fafafa;
    border-radius:20px;
    cursor:pointer;
    transition:all .2s ease;
    border:1px solid transparent;
  }
  .artist-profile:hover{
    background:#fff;
    border-color:#eee;
    box-shadow:0 10px 24px rgba(0,0,0,0.06);
    transform:translateY(-2px);
  }
  .avatar{ width:44px; height:44px; border-radius:50%; background:#eee; overflow:hidden; }
  .avatar img{ width:100%; height:100%; object-fit:cover; }
  .artist-info{ flex:1; }
  .artist-info h4{ margin:0; font-size:13px; color:#222; font-weight:900; }
  .artist-info p{ margin:2px 0 0; font-size:11px; color:#888; }
  .artist-cta{ font-size:11px; font-weight:900; color:#333; text-transform:uppercase; letter-spacing:0.06em; }

  .actions{ display:flex; gap:12px; margin-top:18px; }
  .btn{
    padding:14px 20px; border-radius:16px;
    border:none; font-size:13px; font-weight:800;
    cursor:pointer;
  }
  .btn-primary{ background:#111; color:#fff; flex:1; }
  .btn-ghost{ background:#f0f0f0; color:#666; }

  /* SERVICES (same as your file) */
  .services-wrap{ margin-top:10px; }
  .services-grid{
    display:grid;
    grid-template-columns:repeat(4, minmax(0, 1fr));
    gap:16px;
    margin-top:18px;
  }
  .svc-card{
    background:#fff;
    border:1px solid #f0f0f0;
    border-radius:22px;
    padding:18px 18px 16px;
    box-shadow:0 10px 24px rgba(0,0,0,0.06);
    transition:transform .22s ease, box-shadow .22s ease;
    min-height:160px;
  }
  .svc-card:hover{
    transform:translateY(-5px);
    box-shadow:0 18px 44px rgba(0,0,0,0.10);
  }
  .svc-ico{
    width:36px; height:36px; border-radius:14px;
    background:#f4f4f4;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:900;
    margin-bottom:12px;
  }
  .svc-title{ font-size:18px; font-weight:950; margin:0 0 8px; color:#3f3f3f; }
  .svc-desc{ margin:0; color:#666; line-height:1.6; font-size:13px; }

  .process{
    margin-top:26px;
    border-radius:28px;
    border:1px solid #efefef;
    background:#fff;
    padding:26px 22px;
    box-shadow:0 18px 40px rgba(0,0,0,0.06);
  }
  .process-head h2{
    margin:0 0 6px;
    font-size:28px;
    font-weight:950;
    color:#111;
    letter-spacing:-0.02em;
  }
  .process-head p{ margin:0 0 18px; color:#666; line-height:1.6; }

  .process-grid{
    position:relative;
    display:grid;
    grid-template-columns:70px 1fr;
    gap:16px;
    padding:6px 0 2px;
  }
  .proc-rail{ position:relative; }
  .proc-line{
    position:absolute;
    left:34px;
    width:2px;
    background:#ddd;
    border-radius:999px;
  }
  .proc-dot{
    position:absolute;
    left:34px;
    top:0;
    width:18px; height:18px;
    border-radius:50%;
    background:#111;
    transform:translate(-50%, -50%);
    transition:top .14s linear;
    box-shadow:0 10px 18px rgba(0,0,0,0.12);
  }

  .proc-items{ display:flex; flex-direction:column; gap:18px; }
  .proc-step{
    border-radius:26px;
    border:1px solid #efefef;
    background:#fff;
    padding:22px;
    box-shadow:0 14px 30px rgba(0,0,0,0.06);
    display:grid;
    grid-template-columns:1fr 220px;
    gap:18px;
    min-height:160px;
    align-items:center;
  }
  .proc-kicker{
    font-size:12px;
    font-weight:950;
    letter-spacing:0.10em;
    text-transform:uppercase;
    color:#999;
    margin:0 0 8px;
  }
  .proc-title{ margin:0 0 8px; font-size:20px; font-weight:950; color:#111; }
  .proc-desc{ margin:0; color:#666; line-height:1.65; }
  .proc-illus{
    height:120px;
    border-radius:20px;
    border:1px solid #f0f0f0;
    background:linear-gradient(180deg,#f8f8f8,#f2f2f2);
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:900; color:#bbb; letter-spacing:0.08em;
    text-transform:uppercase;
    font-size:12px;
  }

  .form-title{ font-size:18px; font-weight:950; margin:0 0 18px; text-align:left; }
  .form-group{ margin-bottom:12px; }
  .form-input{
    display:block; width:100%;
    padding:14px;
    border:1px solid #eee;
    border-radius:14px;
    background:#fafafa;
    font-size:14px;
    color:#111;
  }
  .form-input:focus{ outline:none; border-color:#111; background:#fff; }
  .btn-submit{
    width:100%;
    background:#2a2a2a; color:#fff;
    padding:14px;
    border-radius:14px;
    border:none;
    font-weight:950;
    cursor:pointer;
  }
  #formSuccess{ display:none; border-radius:14px; margin-top:14px; background:#f0f0f0; color:#333; padding:18px; }

  .modal-overlay{
    position:fixed; inset:0;
    background:rgba(0,0,0,0.45);
    backdrop-filter:blur(5px);
    z-index:9999;
    display:none;
    align-items:center;
    justify-content:center;
    opacity:0; transition:opacity .25s ease;
  }
  .modal-overlay.open{ display:flex; opacity:1; }
  .modal-box{
    background:#fff;
    width:90%;
    max-width:420px;
    padding:28px;
    border-radius:26px;
    box-shadow:0 24px 60px rgba(0,0,0,0.22);
    transform:translateY(18px);
    transition:transform .25s cubic-bezier(.2,.8,.2,1);
    max-height:90vh;
    overflow-y:auto;
  }
  .modal-overlay.open .modal-box{ transform:translateY(0); }
  .close-modal{ position:absolute; top:16px; right:16px; background:none; border:none; font-size:22px; color:#999; cursor:pointer; }

  .site-footer{
    margin-top:28px;
    background:#262626;
    color:#fff;
    border-radius:22px;
    overflow:hidden;
    box-shadow:0 18px 44px rgba(0,0,0,0.18);
  }
  .site-footer .ft-top{ padding:26px 24px 16px; }
  .site-footer .ft-brand{
    font-weight:950;
    letter-spacing:0.18em;
    text-transform:uppercase;
    font-size:13px;
    opacity:.92;
  }
  .site-footer .ft-note{
    margin-top:10px;
    color:rgba(255,255,255,0.80);
    line-height:1.7;
    font-size:13px;
    max-width:780px;
  }
  .site-footer .ft-grid{
    display:grid;
    grid-template-columns:1.2fr 1fr 1fr;
    gap:18px;
    padding:18px 24px 22px;
    border-top:1px solid rgba(255,255,255,0.10);
  }
  .ft-title{
    font-weight:950;
    letter-spacing:0.18em;
    text-transform:uppercase;
    font-size:12px;
    opacity:.85;
    margin-bottom:12px;
  }
  .ft-text{ color:rgba(255,255,255,0.82); font-size:13px; line-height:1.7; }
  .ft-links a{
    display:block;
    padding:10px 0;
    color:rgba(255,255,255,0.85);
    text-decoration:none;
    border-bottom:1px solid rgba(255,255,255,0.10);
    font-weight:750;
  }
  .ft-links a:last-child{ border-bottom:none; }
  .ft-links a:hover{ color:#fff; }

  .ft-social a{
    display:flex;
    align-items:center;
    gap:12px;
    padding:10px 0;
    color:rgba(255,255,255,0.88);
    text-decoration:none;
    border-bottom:1px solid rgba(255,255,255,0.10);
    font-weight:800;
  }
  .ft-social a:last-child{ border-bottom:none; }
  .ft-ic{
    width:34px;height:34px;border-radius:999px;
    background:rgba(255,255,255,0.12);
    display:flex;align-items:center;justify-content:center;
    font-weight:950;
  }
  .ft-copy{
    padding:0 24px 22px;
    color:rgba(255,255,255,0.70);
    font-size:12px;
    font-weight:800;
  }

  #sect-about,
  #sect-services,
  #sect-contact{
    background:#000;
    color:#fff;
  }
  #sect-about .section-scroll,
  #sect-services .section-scroll,
  #sect-contact .section-scroll{
    background:#000;
    color:#fff;
  }
  #sect-about .sec-title,
  #sect-services .sec-title,
  #sect-contact .sec-title{
    color:#fff;
  }
  #sect-about .sec-sub,
  #sect-services .sec-sub,
  #sect-contact .sec-sub{
    color:rgba(255,255,255,0.78);
  }
  #sect-about .about-lead,
  #sect-about .about-sublead{
    color:rgba(255,255,255,0.8);
  }
  #sect-about .about-card{
    background:#0b0b0b;
    border-color:#1e1e1e;
    box-shadow:0 18px 40px rgba(0,0,0,0.55);
  }
  #sect-about .about-card-title{ color:#fff; }
  #sect-about .about-card-meta{ color:rgba(255,255,255,0.6); }
  #sect-about .about-card-desc{ color:rgba(255,255,255,0.75); }
  #sect-about .about-card-media{
    background:#111;
    border-color:#222;
  }
  #sect-about .about-card-media::before{ background:rgba(255,255,255,0.08); }

  #sect-services .svc-card{
    background:#0b0b0b;
    border-color:#1e1e1e;
    box-shadow:0 18px 40px rgba(0,0,0,0.55);
  }
  #sect-services .svc-card:hover{ box-shadow:0 22px 48px rgba(0,0,0,0.7); }
  #sect-services .svc-ico{
    background:#111;
    color:#d4af37;
  }
  #sect-services .svc-title{ color:#fff; }
  #sect-services .svc-desc{ color:rgba(255,255,255,0.75); }

  #sect-about .process,
  #sect-services .process{
    background:transparent;
  }
  #sect-about .process-head h2,
  #sect-services .process-head h2{
    color:#fff;
  }
  #sect-about .process-head p,
  #sect-services .process-head p{
    color:rgba(255,255,255,0.7);
  }
  #sect-about .proc-step,
  #sect-services .proc-step{
    background:#0b0b0b;
    border-color:#1e1e1e;
  }
  #sect-about .proc-title,
  #sect-services .proc-title{
    color:#fff;
  }
  #sect-about .proc-desc,
  #sect-services .proc-desc{
    color:rgba(255,255,255,0.7);
  }
  #sect-about .proc-kicker,
  #sect-services .proc-kicker{
    color:rgba(255,255,255,0.55);
  }
  #sect-about .proc-illus,
  #sect-services .proc-illus{
    background:#111;
    color:rgba(255,255,255,0.55);
  }
  #sect-about .proc-line,
  #sect-services .proc-line{
    background:rgba(255,255,255,0.2);
  }
  #sect-about .proc-dot,
  #sect-services .proc-dot{
    background:#d4af37;
  }

  #sect-contact .form-input{
    background:#0f0f0f;
    border-color:#222;
    color:#fff;
  }
  #sect-contact .form-input::placeholder{ color:rgba(255,255,255,0.55); }
  #sect-contact .form-input:focus{
    border-color:#d4af37;
    background:#111;
  }
  #sect-contact .btn-submit{
    background:#d4af37;
    color:#000;
  }
  #sect-contact #formSuccess{
    background:#0f0f0f;
    color:#fff;
    border:1px solid #222;
  }
  #sect-contact .site-footer{
    background:#0f0f0f;
    box-shadow:0 18px 44px rgba(0,0,0,0.5);
  }

  @media (max-width:900px){
    body{
      height:auto;
      min-height:100vh;
      overflow-y:auto;
      align-items:stretch;
      justify-content:flex-start;
    }
    .layout{ height:auto; min-height:100vh; }
    .layout{ flex-direction:column; }
    #map{ width:100%; height:100%; }
    .shop{
      width:100%;
      height:auto;
      flex:none;
      border-radius:0;
      margin-top:0;
      z-index:40;
      overflow:visible;
    }
    .app-section{
      position:relative;
      inset:auto;
      height:auto;
      min-height:0;
      transform:none;
    }
    .app-section:not(.active-section){
      display:none;
      opacity:0;
      visibility:hidden;
      pointer-events:none;
    }
    .app-section.active-section{ display:flex; }
    .side-nav{ display:none; }
    .mobile-nav{ display:flex; }
    .section-scroll{ padding:22px; height:auto; overflow:visible; }

    /* HOME mobile */
    .home-screen{
      --home-pad-left:20px;
      --home-pad-right:20px;
      height:auto;
      overflow:visible;
      padding:22px var(--home-pad-right) 64px var(--home-pad-left);
      gap:12px;
    }
    #sect-home .section-scroll{
      padding:16px 0;
      height:auto;
      overflow:visible;
    }
    .display-head{ padding:0 16px; }
    .display-head h1{ font-size:26px; }
    .display-frame{
      height:100vh;
      min-height:100vh;
      flex:none;
      gap:0;
      padding:0;
    }
    .frame-top-bar,
    .frame-bottom-bar{
      flex:0 0 10vh;
      height:10vh;
    }
    .frame-split{ flex-direction:column; }
    .frame-left,
    .frame-right{
      width:100%;
    }
    .frame-left{ height:40vh; }
    .frame-right{ height:40vh; min-height:40vh; }
    .display-table-wrap{ padding:0 16px 20px; }
    .display-table th,
    .display-table td{
      font-size:12px;
      padding:8px;
    }
    .home-top{ --home-logo-width:min(520px, 92%); }
    .home-top small{ font-size:18px; padding-left:5%; }
    .home-tagline{ font-size:15px; letter-spacing:0.4em; }
    .home-main{ grid-template-columns:1fr; gap:12px; align-items:stretch; margin-top:0; border-radius:0; }
    .home-banner{
      position:static;
      width:100%;
      padding:20px 18px;
    }
    .home-banner-title{ font-size:22px; }
    .home-banner-btn{ font-size:18px; padding:12px 21px; }
    .home-copy{ margin:0 0 10px 0; width:100%; }
    .home-copy-title{ font-size:30px; line-height:1.4; }
    .home-glass{ padding:20px 20px; height:auto; min-height:0; max-height:none; }
    .btn-home{ font-size:12px; padding:12px 22px; }
    .home-illustration-wrap{ height:auto; justify-content:flex-start; padding:0; }
    .home-illustration-track{ gap:0; padding:0; scroll-padding-left:0; }
    .home-slide{ padding:0; flex-direction:column; align-items:stretch; }
    .home-slide-media{ width:100%; height:220px; padding-left:0; }
    .home-illustration{ border-radius:0; }
    .home-slider-controls{ left:14px; right:14px; bottom:12px; }
    .home-slider-dots{ gap:8px; }
    .home-dot{ width:7px; height:7px; }
    .home-dot.active{ width:18px; }
    .home-slider-arrows{ gap:10px; }
    .home-arrow{ font-size:16px; }

    /* 3D popup mobile */
    .map-3d-popup{
      left:50%;
      top:50%;
      width:30%;
      max-width:260px;
      min-width:140px;
      transform:translate(-50%, -50%);
    }

    .shop-head{ padding:18px 18px; }
    .shop-body{ padding:18px 18px 70px; }
    .grid{ grid-template-columns:repeat(2, 1fr); gap:14px; }
    .card{ padding:16px 12px; border-radius:24px; }
    .card-media{ height:118px; }

    /* SOLO frame mobile */
    #sect-gallery.solo .solo-frame-head{ top:14px; left:16px; right:16px; }
    #sect-gallery.solo .solo-frame-foot{
      padding:14px 16px;
      flex-direction:column;
      align-items:stretch;
      gap:12px;
    }
    .solo-tabs-bar{ padding:8px 16px 12px; }
    .media-tabs{ padding:4px; gap:4px; }
    .media-tab{ padding:6px 10px; font-size:8px; letter-spacing:0.05em; }
    .solo-foot-right{ width:100%; align-items:stretch; }
    .solo-bottom-tabs-inner{ width:100%; justify-content:space-between; }
    .solo-bottom-tab{ flex:1; padding:10px 8px; font-size:10px; }
    .solo-tab-wrap{ flex:1; }
    .solo-popover{ gap:8px; padding:10px; }
    .solo-suboption{ flex:1; text-align:center; padding:12px 10px; font-size:11px; }
    .solo-info-card{
      left:16px; right:16px;
      top:auto; bottom:128px;
      width:auto; max-width:none;
      transform:translateY(12px);
    }
    #sect-gallery.solo .solo-frame.info-open .solo-info-card{ transform:translateY(0); }

    .services-grid{ grid-template-columns:repeat(2, minmax(0, 1fr)); }
    .proc-step{ grid-template-columns:1fr; }
    .proc-illus{ height:100px; }
    .process-grid{ grid-template-columns:54px 1fr; }
    .proc-line, .proc-dot{ left:26px; }
    .about-grid{ grid-template-columns:1fr; }
    #sect-about .section-scroll{ padding:22px; }
    #sect-about .sec-title{ font-size:34px; margin-bottom:10px; }
    .about-lead{ font-size:20px; line-height:1.7; margin-bottom:12px; }
    .about-sublead{ font-size:15px; line-height:1.7; margin-bottom:18px; }
    .about-card{ min-height:auto; border-radius:22px; padding:16px; }
    .about-card-media{ height:112px; border-radius:18px; }
    .about-card-media::before{ width:64px; height:10px; top:10px; left:10px; }
    .about-card-title{ font-size:17px; }
    .about-card-desc{ font-size:12px; }
    .site-footer .ft-grid{ grid-template-columns:1fr; }
  }

  @media (max-width:900px){
    .home-split{
      flex-direction:column;
      height:auto;
    }
    .home-split-left,
    .home-split-right{
      width:100%;
      height:auto;
    }
    .home-split-right{
      height:80vh;
      min-height:320px;
    }
  }

  @media (max-width:420px){
    .mobile-nav{ left:8px; right:8px; bottom:30px; padding:5px; gap:3px; }
    .mobile-nav .nav-item{ font-size:9px; padding:9px 4px; letter-spacing:0.04em; }
  }
</style>
</head>

<body>
<div class="layout">
  <div class="display-frame">
    <div class="frame-top-bar" aria-hidden="true"></div>
    <div class="frame-split">
      <nav class="side-nav" id="sideNav">
        <div class="nav-item active" id="navGallery">0.</div>
        <div class="nav-item" id="navAbout">1.</div>
        <div class="nav-item" id="navServices">2.</div>
        <div class="nav-item" id="navContact">3.</div>
        <div class="nav-item" id="navExtra1">4.</div>
        <div class="nav-item" id="navExtra2">5.</div>
        <div class="nav-item" id="navExtra3">6.</div>
        <div class="nav-item" id="navExtra4">7.</div>
        <div class="nav-item" id="navExtra5">8.</div>
      </nav>

      <nav class="mobile-nav" id="mobileNav">
        <div class="nav-item active" id="mNavGallery">0.</div>
        <div class="nav-item" id="mNavAbout">1.</div>
        <div class="nav-item" id="mNavServices">2.</div>
        <div class="nav-item" id="mNavContact">3.</div>
        <div class="nav-item" id="mNavExtra1">4.</div>
        <div class="nav-item" id="mNavExtra2">5.</div>
        <div class="nav-item" id="mNavExtra3">6.</div>
        <div class="nav-item" id="mNavExtra4">7.</div>
        <div class="nav-item" id="mNavExtra5">8.</div>
      </nav>
      <div class="frame-left">
        <iframe
          class="fnn3dFrame"
          id="leftKaabaFrame"
          src="/fnn-3d/"
          title="FNN 3D"
          allow="fullscreen; autoplay"
          allowfullscreen
          loading="eager"
        ></iframe>
      </div>
      <div class="frame-right show-map" id="frameRight">
        <div class="map-panel" id="mapPanel">
          <div id="map"></div>
          <div class="map-kaaba-box" aria-hidden="true">
            <div class="kaaba-cube">
              <span class="kaaba-face front"></span>
              <span class="kaaba-face back"></span>
              <span class="kaaba-face right"></span>
              <span class="kaaba-face left"></span>
              <span class="kaaba-face top"></span>
              <span class="kaaba-face bottom"></span>
            </div>
          </div>
        </div>
        <div class="kaaba-panel" id="kaabaPanel">
          <iframe
            class="fnn3dFrame"
            src="/fnn-3d-kaaba/"
            title="FNN 3D Kaaba"
            allow="fullscreen; autoplay"
            allowfullscreen
            loading="eager"
          ></iframe>
        </div>
        <aside class="shop" id="shop">

    <!-- HOME -->
    <section id="sect-home" class="app-section" dir="rtl">
      <div class="section-scroll"></div>
    </section>

        <!-- ABOUT -->
    <section id="sect-about" class="app-section" dir="rtl">
      <div class="section-scroll">
        <div class="about-wrap">
          <h1 class="sec-title">امامة</h1>

          <p class="about-lead">
            الإمامة رسالة تجمع بين حسن التلاوة، وجمال الخلق، والقدرة على توحيد القلوب في بيوت الله. نعرض هنا لمحات عن أئمة بارزين أثّروا في الملايين بصوتهم وخطبتهم وحضورهم الروحي.
          </p>

          <p class="about-sublead">
            هذه النماذج ليست مجرد أصوات جميلة، بل مسارات علمية ودعوية ممتدة: حفظ للقرآن، تعليم للأجيال، وخدمة للحرمين والمساجد حول العالم. هدفنا إبراز قيمة الإمامة بوصفها مسؤولية وأمانة تُبنى بالعلم والورع والاستمرارية.
          </p>

          <div class="about-grid">
            <article class="about-card">
              <div class="about-card-media">
                <img src="https://upload.wikimedia.org/wikipedia/commons/1/18/Abdul-Rahman_Al-Sudais_%28Cropped%2C_2011%29.jpg" alt="الشيخ عبد الرحمن السديس">
              </div>
              <div class="about-card-meta">إمام الحرم المكي</div>
              <h3 class="about-card-title">الشيخ عبد الرحمن السديس</h3>
              <p class="about-card-desc">
                من أبرز أئمة الحرم المكي وخطبائه، عُرف بصوته الهادئ وخطبه المؤثرة. يجمع بين الحضور الإداري والعمل الدعوي، وله إسهامات في خدمة القرآن وتعليم الناس آداب العبادة.
              </p>
            </article>

            <article class="about-card">
              <div class="about-card-media">
                <img src="https://upload.wikimedia.org/wikipedia/commons/9/90/Maher_Al_Mueaqly.png" alt="الشيخ ماهر المعيقلي">
              </div>
              <div class="about-card-meta">إمام الحرم المكي</div>
              <h3 class="about-card-title">الشيخ ماهر المعيقلي</h3>
              <p class="about-card-desc">
                اشتهر بتلاوته الخاشعة وتوازن الأداء بين المقامات والوقف، مما جعل صوته محبوبًا لدى كثير من المسلمين. أسهم في نشر التلاوة عبر المحافل والدروس، ويُعد من القرّاء المعاصرين الأكثر تأثيرًا.
              </p>
            </article>

            <article class="about-card">
              <div class="about-card-media">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8b/Yasser_Al-Dosari_%28cropped%29.jpg/960px-Yasser_Al-Dosari_%28cropped%29.jpg" alt="الشيخ ياسر الدوسري">
              </div>
              <div class="about-card-meta">إمام جامع وخطيب</div>
              <h3 class="about-card-title">الشيخ ياسر الدوسري</h3>
              <p class="about-card-desc">
                قارئ معروف بجمال الترتيل وحسن الأداء، وله حضور واسع في ليالي رمضان والمناسبات الكبرى. يمتاز بأسلوب روحي عميق يلامس القلوب، ويقدم نموذجًا للإمامة التي تجمع بين العلم والخشوع.
              </p>
            </article>
          </div>

          <div class="process">
            <div class="process-head">
              <h2>تاريخ الإمامة عبر الزمن</h2>
              <p>محطات زمنية توضح تطور الإمامة ودورها في بناء المجتمع المسلم.</p>
            </div>

            <div class="process-grid">
              <div class="proc-rail">
                <div class="proc-line"></div>
                <div class="proc-dot"></div>
              </div>

              <div class="proc-items">
                <div class="proc-step"><div><div class="proc-kicker">المرحلة 1</div><h3 class="proc-title">بدايات الإمامة في مسجد النبي</h3><p class="proc-desc">تنظيم الصفوف وتقديم الأقرأ للناس في الصلاة، وتأسيس القدوة الأولى للإمامة.</p></div><div class="proc-illus">محطة</div></div>
                <div class="proc-step"><div><div class="proc-kicker">المرحلة 2</div><h3 class="proc-title">عهد الخلفاء الراشدين</h3><p class="proc-desc">ترسيخ النظام الجماعي للصلاة، وتوسيع دور الإمام في التعليم والإرشاد.</p></div><div class="proc-illus">محطة</div></div>
                <div class="proc-step"><div><div class="proc-kicker">المرحلة 3</div><h3 class="proc-title">تدوين علوم القراءات</h3><p class="proc-desc">نشأت مدارس القراءات وضبط الأداء، مما عزز مكانة الإمام المقرئ.</p></div><div class="proc-illus">محطة</div></div>
                <div class="proc-step"><div><div class="proc-kicker">المرحلة 4</div><h3 class="proc-title">ازدهار حلقات العلم</h3><p class="proc-desc">تحولت المساجد إلى مراكز تعليمية، وصار الإمام محورًا للعلم والعبادة.</p></div><div class="proc-illus">محطة</div></div>
                <div class="proc-step"><div><div class="proc-kicker">المرحلة 5</div><h3 class="proc-title">تنظيم الإمامة في الحرمين</h3><p class="proc-desc">تحديد المعايير والاختيار الرسمي للأئمة مع توسع عمارة الحرمين.</p></div><div class="proc-illus">محطة</div></div>
                <div class="proc-step"><div><div class="proc-kicker">المرحلة 6</div><h3 class="proc-title">العهد الحديث والمعاهد الشرعية</h3><p class="proc-desc">تأسيس برامج إعداد الأئمة وترسيخ الجانب العلمي والمهاري للإمامة.</p></div><div class="proc-illus">محطة</div></div>
                <div class="proc-step"><div><div class="proc-kicker">المرحلة 7</div><h3 class="proc-title">بث التلاوات عالميًا</h3><p class="proc-desc">انتشار صوت الإمامة عبر الإذاعة والتلفاز، ووصولها إلى ملايين المسلمين.</p></div><div class="proc-illus">محطة</div></div>
                <div class="proc-step"><div><div class="proc-kicker">المرحلة 8</div><h3 class="proc-title">العصر الرقمي</h3><p class="proc-desc">منصات تعليمية وبث مباشر حفظت صوت الإمامة وربطت المجتمعات عالميًا.</p></div><div class="proc-illus">محطة</div></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- SERVICES -->
    <section id="sect-services" class="app-section" dir="rtl">
      <div class="section-scroll">
        <h1 class="sec-title">المؤذنون</h1>
        <p class="sec-sub">نماذج متنوعة لدور المؤذن في الحياة اليومية، من الحرمين إلى مساجد الأحياء والتعليم.</p>

        <div class="services-wrap">
          <div class="services-grid" id="servicesGrid">
            <div class="svc-card"><div class="svc-ico">•</div><h3 class="svc-title">مؤذن الحرم المكي</h3><p class="svc-desc">صوتٌ يرفع النداء في أقدس بقاع الأرض ويجمع القلوب على الصلاة.</p></div>
            <div class="svc-card"><div class="svc-ico">•</div><h3 class="svc-title">مؤذن الحرم النبوي</h3><p class="svc-desc">يؤذن في مسجد رسول الله ﷺ ويحمل أثر المدينة وروحها.</p></div>
            <div class="svc-card"><div class="svc-ico">•</div><h3 class="svc-title">مؤذن المسجد الأقصى</h3><p class="svc-desc">يحافظ على نداء الصلاة في أولى القبلتين وثالث الحرمين.</p></div>
            <div class="svc-card"><div class="svc-ico">•</div><h3 class="svc-title">مؤذن الجمعة</h3><p class="svc-desc">يهيئ القلوب لسماع الخطبة ويعلن اجتماع الناس.</p></div>

            <div class="svc-card"><div class="svc-ico">•</div><h3 class="svc-title">مؤذن الفجر</h3><p class="svc-desc">نداء السكينة وبداية يوم بالإيمان والطمأنينة.</p></div>
            <div class="svc-card"><div class="svc-ico">•</div><h3 class="svc-title">مؤذن العيد</h3><p class="svc-desc">يرفع التكبيرات الجامعة ويعلن فرحة المسلمين.</p></div>
            <div class="svc-card"><div class="svc-ico">•</div><h3 class="svc-title">مؤذن التراويح</h3><p class="svc-desc">يصاحب ليالي رمضان بنداء يملؤها خشوعًا.</p></div>
            <div class="svc-card"><div class="svc-ico">•</div><h3 class="svc-title">مؤذن الحي</h3><p class="svc-desc">قريب من الناس، يعرف احتياجاتهم ويضبط المواقيت.</p></div>

            <div class="svc-card"><div class="svc-ico">•</div><h3 class="svc-title">مؤذن المدارس</h3><p class="svc-desc">يعزز حضور الصلاة في بيئات التعليم والتربية.</p></div>
            <div class="svc-card"><div class="svc-ico">•</div><h3 class="svc-title">مؤذن المستشفيات</h3><p class="svc-desc">يطمئن المرضى والعاملين بتذكير رحيم.</p></div>
            <div class="svc-card"><div class="svc-ico">•</div><h3 class="svc-title">مؤذن المناسبات</h3><p class="svc-desc">ينسق النداء في التجمعات الكبرى والمواسم.</p></div>
            <div class="svc-card"><div class="svc-ico">•</div><h3 class="svc-title">مؤذن البث المباشر</h3><p class="svc-desc">يوصل النداء عبر الإذاعة والشاشات لملايين المستمعين.</p></div>
          </div>

          <div class="process" id="processBlock">
            <div class="process-head">
              <h2>تاريخ الأذان عبر الزمن</h2>
              <p>محطات مختصرة تروي كيف انتقل الأذان من المدينة إلى العالم كله.</p>
            </div>

            <div class="process-grid" id="processGrid">
              <div class="proc-rail">
                <div class="proc-line"></div>
                <div class="proc-dot" id="procDot"></div>
              </div>

              <div class="proc-items" id="procItems">
                <div class="proc-step"><div><div class="proc-kicker">المرحلة 1</div><h3 class="proc-title">تشريع الأذان في المدينة</h3><p class="proc-desc">أُقرّ الأذان نداءً رسميًا للصلاة بعد الهجرة.</p></div><div class="proc-illus">محطة</div></div>
                <div class="proc-step"><div><div class="proc-kicker">المرحلة 2</div><h3 class="proc-title">اختيار بلال رضي الله عنه</h3><p class="proc-desc">أول مؤذن بصوته الندي الذي علّم الأمة معنى النداء.</p></div><div class="proc-illus">محطة</div></div>
                <div class="proc-step"><div><div class="proc-kicker">المرحلة 3</div><h3 class="proc-title">انتشار الأذان مع الفتوحات</h3><p class="proc-desc">انتقل النداء إلى الأمصار مع اتساع الدولة الإسلامية.</p></div><div class="proc-illus">محطة</div></div>
                <div class="proc-step"><div><div class="proc-kicker">المرحلة 4</div><h3 class="proc-title">بناء المآذن ورفع النداء</h3><p class="proc-desc">أصبحت للمساجد مآذن تميزها ويرتفع منها الأذان.</p></div><div class="proc-illus">محطة</div></div>
                <div class="proc-step"><div><div class="proc-kicker">المرحلة 5</div><h3 class="proc-title">تنوع المقامات والأساليب</h3><p class="proc-desc">تجمّل الأداء دون تغيير الصيغة، مع الحفاظ على الوقار.</p></div><div class="proc-illus">محطة</div></div>
                <div class="proc-step"><div><div class="proc-kicker">المرحلة 6</div><h3 class="proc-title">تنظيم الأذان رسميًا</h3><p class="proc-desc">توحيد المواقيت والإشراف المؤسسي على المؤذنين.</p></div><div class="proc-illus">محطة</div></div>
                <div class="proc-step"><div><div class="proc-kicker">المرحلة 7</div><h3 class="proc-title">البث الإذاعي والتلفزيوني</h3><p class="proc-desc">وصول الأذان من الحرمين إلى ملايين المستمعين عالميًا.</p></div><div class="proc-illus">محطة</div></div>
                <div class="proc-step"><div><div class="proc-kicker">المرحلة 8</div><h3 class="proc-title">العصر الرقمي والتطبيقات</h3><p class="proc-desc">تنبيهات ومواقيت دقيقة تبث الأذان وتخدم المجتمعات.</p></div><div class="proc-illus">محطة</div></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
<!-- GALLERY -->
    <section id="sect-gallery" class="app-section active-section" dir="rtl">
      <header class="shop-head">
        <nav class="nav-group" id="filters">
          <button class="chip active" data-filter="all" id="btnAll">الكل</button>
          <button class="chip" data-filter="halaqat-quran">الحلقات القرآنية</button>
          <button class="chip" data-filter="mushaf">المصاحف</button>
          <button class="chip" data-filter="halaqat-ilm">الحلقات العلمية</button>
          <button class="chip" data-filter="durus">الدروس</button>
        </nav>
      </header>

      <div class="shop-body">
        <div class="grid" id="grid"></div>

        <div class="solo-wrap" id="soloWrap">
          <div class="back-nav"><button class="btn-back" id="btnBack">&larr; العودة إلى المعرض</button></div>

          <div class="solo-frame">
            <div class="solo-frame-head">
              <div class="solo-name" id="soloName">عنصر</div>
            </div>
            <div class="solo-media-container" id="soloMedia"></div>
            <div class="solo-tabs-bar"><div id="soloTabs"></div></div>

            <aside class="solo-info-card" id="soloInfoCard" aria-hidden="true">
              <button class="solo-info-close" type="button" id="soloInfoClose" aria-label="إغلاق المعلومات">&times;</button>
              <div class="solo-info-title" id="soloInfoName">عنصر</div>
              <div class="solo-info-text">محتوى معرفي يعكس روح المكان والدرس.</div>
              <div class="solo-info-meta">
                <div class="solo-meta-item"><span>المحتوى</span><strong id="soloInfoMat">--</strong></div>
                <div class="solo-meta-item"><span>النطاق</span><strong id="soloInfoDim">--</strong></div>
                <div class="solo-meta-item"><span>الموقع</span><strong id="soloInfoLoc">--</strong></div>
              </div>
            </aside>

            <div class="solo-config" id="soloConfig" aria-hidden="true">
              <button class="solo-config-close" type="button" id="soloConfigClose" aria-label="إغلاق المخصص">&times;</button>
              <div class="solo-config-title">المخصص</div>
              <div class="solo-config-group">
                <div class="solo-config-label">اللون</div>
                <div class="solo-config-options" id="soloConfigColors" role="group" aria-label="اختر اللون">
                  <button class="solo-config-option" type="button" data-color="أحمر">أحمر</button>
                  <button class="solo-config-option" type="button" data-color="أزرق">أزرق</button>
                  <button class="solo-config-option" type="button" data-color="رملي">رملي</button>
                </div>
              </div>
              <div class="solo-config-group">
                <div class="solo-config-label">الحجم</div>
                <div class="solo-config-options" id="soloConfigSizes" role="group" aria-label="اختر الحجم">
                  <button class="solo-config-option" type="button" data-size="صغير">صغير</button>
                  <button class="solo-config-option" type="button" data-size="متوسط">متوسط</button>
                  <button class="solo-config-option" type="button" data-size="كبير">كبير</button>
                </div>
              </div>
              <div class="solo-config-summary" id="soloConfigSummary">الاختيار: -- / --</div>
            </div>

            <div class="solo-frame-foot">
              <div class="solo-foot-left">
                <div class="solo-foot-title" id="soloFootTitle">عنصر</div>
                <div class="solo-foot-desc" id="soloFootDesc">محتوى تعليمي وروحي يخدم المجتمع ويعزز المعرفة.</div>
              </div>

              <div class="solo-foot-right">
                <div class="solo-bottom-tabs" aria-label="خيارات العنصر">
                  <div class="solo-bottom-tabs-inner">
                    <button class="solo-bottom-tab" type="button" id="soloInfoBtn" aria-controls="soloInfoCard" aria-expanded="false">معلومات</button>

                    <div class="solo-tab-wrap">
                      <button class="solo-bottom-tab" type="button" id="soloColorBtn" aria-expanded="false">اللون</button>
                      <div class="solo-popover" id="soloColorPopover" hidden>
                        <button class="solo-suboption" type="button" data-color="أحمر">أحمر</button>
                        <button class="solo-suboption" type="button" data-color="أزرق">أزرق</button>
                        <button class="solo-suboption" type="button" data-color="رملي">رملي</button>
                      </div>
                    </div>

                    <div class="solo-tab-wrap">
                      <button class="solo-bottom-tab" type="button" id="soloSizeBtn" aria-expanded="false">الحجم</button>
                      <div class="solo-popover" id="soloSizePopover" hidden>
                        <button class="solo-suboption" type="button" data-size="صغير">صغير</button>
                        <button class="solo-suboption" type="button" data-size="متوسط">متوسط</button>
                        <button class="solo-suboption" type="button" data-size="كبير">كبير</button>
                      </div>
                    </div>

                    <button class="solo-bottom-tab" type="button" id="soloCustomsBtn" aria-controls="soloConfig" aria-expanded="false">تخصيص</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="solo-info-block">
            <div class="solo-desc">
              <strong id="soloTitle">عنصر</strong><br>
              محتوى يعكس المعرفة والروح ويعزز الحضور التعليمي.
              <div class="data-row">
                <div class="data-item"><span>المحتوى</span><span id="spMat">--</span></div>
                <div class="data-item"><span>النطاق</span><span id="spDim">--</span></div>
                <div class="data-item"><span>الموقع</span><span id="soloStore">--</span></div>
              </div>
            </div>

            <div class="artist-profile" id="artistBtn">
              <div class="avatar"><img id="artistImg" src="" alt="المشرف"></div>
              <div class="artist-info"><h4 id="artistName">--</h4><p id="artistRole">--</p></div>
              <div class="artist-cta">عرض نبذة →</div>
            </div>

            <div class="actions">
              <button class="btn btn-primary" id="btnContactProduct">تواصل معنا</button>
              <button class="btn btn-ghost" id="btnClose">إغلاق</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- CONTACT -->
    <section id="sect-contact" class="app-section" dir="rtl">
      <div class="section-scroll">
        <h1 class="sec-title">تواصل معنا</h1>
        <p class="sec-sub">هل لديك استفسار؟ تواصل معنا.</p>

        <form id="ajaxForm" action="https://formsubmit.co/anaskaroti@gmail.com" method="POST">
          <input type="hidden" name="_captcha" value="false">
          <input type="hidden" name="_template" value="table">

          <div class="form-group"><input type="text" class="form-input" name="name" placeholder="الاسم الكامل" required></div>
          <div class="form-group"><input type="email" class="form-input" name="email" placeholder="البريد الإلكتروني" required></div>
          <div class="form-group"><input type="text" class="form-input" name="subject" placeholder="الموضوع" id="formالموضوع"></div>
          <div class="form-group"><textarea class="form-input" name="message" placeholder="الرسالة..." rows="4"></textarea></div>

          <button type="submit" class="btn-submit" id="formSubmitBtn">إرسال الطلب</button>
        </form>

        <div id="formSuccess">شكرًا لك! تم استلام طلبك.</div>

        <footer class="site-footer">
          <div class="ft-top">
            <div class="ft-brand">FNN ART</div>
            <div class="ft-note">
              A modern art platform specializing in the presentation of original artworks by selected artists—connecting creative expression with audiences and institutions.
            </div>
          </div>

          <div class="ft-grid">
            <div>
              <div class="ft-title">تواصل معنا</div>
              <div class="ft-text">
                anaskaroti@gmail.com<br>
              </div>
            </div>

            <div class="ft-links">
              <div class="ft-title">التنقل</div>
              <a href="#" onclick="switchSection('sect-about'); return false;">امامة</a>
              <a href="#" onclick="switchSection('sect-services'); return false;">المؤذنون</a>
              <a href="#" onclick="switchSection('sect-gallery'); return false;">المعرض</a>
              <a href="#" onclick="switchSection('sect-contact'); return false;">تواصل معنا</a>
            </div>

            <div class="ft-social">
              <div class="ft-title">تابعنا</div>
              <a href="#" onclick="return false;"><span class="ft-ic">◎</span>@fnn</a>
              <a href="#" onclick="return false;"><span class="ft-ic">f</span>@fnn</a>
              <a href="#" onclick="return false;"><span class="ft-ic">in</span>@fnn</a>
              <a href="#" onclick="return false;"><span class="ft-ic">▶</span>@fnn</a>
            </div>
          </div>

          <div class="ft-copy">© 2025 FNN ART. جميع الحقوق محفوظة.</div>
        </footer>
      </div>
    </section>

        </aside>
      </div>
    </div>
    <div class="frame-bottom-bar" aria-hidden="true"></div>
  </div>
</div>

<div class="modal-overlay" id="modalArtistOverlay">
  <div class="modal-box" style="position:relative">
    <button class="close-modal" id="closeArtistModal">×</button>
    <div style="text-align:center; margin-bottom:18px;">
      <div style="width:82px;height:82px;border-radius:50%;overflow:hidden;margin:0 auto 14px;">
        <img id="modalArtistImg" src="" alt="" style="width:100%;height:100%;object-fit:cover;">
      </div>
      <h3 id="modalArtistName" style="margin:0 0 6px; font-weight:950;"></h3>
      <span id="modalArtistRole" style="font-size:12px; color:#999; text-transform:uppercase; letter-spacing:0.08em;"></span>
    </div>
    <p id="modalArtistBio" style="font-size:13px; line-height:1.7; color:#555; text-align:center; margin:0;"></p>
  </div>
</div>

<script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
<script src="https://api.mapbox.com/mapbox-gl-js/v3.7.0/mapbox-gl.js"></script>

<script>
  const MAPBOX_TOKEN = "pk.eyJ1IjoiYW5hc2thcm90aSIsImEiOiJjbWhqcHgwcmMwbWM0MmxwZ2V5Z2x5OTN0In0.bpOf-4BsljExZdYZUak_pw";
  const USER_STYLE = "mapbox://styles/mapbox/dark-v11";

  const KAABA_CENTER = [39.8262, 21.4225];
  const KAABA_ZOOM_DESKTOP = 16.8;
  const KAABA_ZOOM_MOBILE = 15.6;
  const KAABA_PITCH = 60;
  const KAABA_BEARING = -25;
  const isMobile = window.innerWidth < 900;
  const startZoom = isMobile ? KAABA_ZOOM_MOBILE : KAABA_ZOOM_DESKTOP;

  let map = null;
  const mapEl = document.getElementById('map');
  const frameRight = document.getElementById('frameRight');
  const enableMapbox = !!(mapEl && window.mapboxgl);

  if(enableMapbox){
    try{
      mapboxgl.accessToken = MAPBOX_TOKEN;
      map = new mapboxgl.Map({
        container: "map",
        style: USER_STYLE,
        center: KAABA_CENTER,
        zoom: startZoom,
        pitch: KAABA_PITCH,
        bearing: KAABA_BEARING,
        projection: 'globe'
      });

      map.on('style.load', () => {
        try {
          map.setFog({
            'color': 'rgb(20, 20, 20)',
            'high-color': 'rgb(90, 90, 90)',
            'space-color': 'rgb(0, 0, 0)',
            'star-intensity': 0.3
          });
        } catch(e){}

        const layers = map.getStyle().layers || [];
        let labelLayerId;
        for (const layer of layers) {
          if (layer.type === 'symbol' && layer.layout && layer.layout['text-field']) {
            labelLayerId = layer.id;
            break;
          }
        }

        if (!map.getLayer('3d-buildings-custom')) {
          try{
            map.addLayer({
              'id': '3d-buildings-custom',
              'source': 'composite',
              'source-layer': 'building',
              'filter': ['==', 'extrude', 'true'],
              'type': 'fill-extrusion',
              'minzoom': 15,
              'paint': {
              'fill-extrusion-color': '#666',
                'fill-extrusion-height': ['get', 'height'],
                'fill-extrusion-base': ['get', 'min_height'],
                'fill-extrusion-opacity': 0.6
              }
            }, labelLayerId);
          } catch(e){}
        }
      });
    } catch(e){
      map = null;
    }
  }

  const DISPLAY_CONTENT = {
    'sect-home': {
      title: 'الرئيسية',
      table: {
        right: 'عرض بانورامي',
        left: 'مشهد تعريفي',
        tech: 'واجهة تفاعلية',
        topic: 'مقدمة'
      }
    },
    'sect-about': {
      title: 'امامة',
      table: {
        right: 'سيرة الإمامة',
        left: 'محطات تاريخية',
        tech: 'ملخص نصي',
        topic: 'نبذة'
      }
    },
    'sect-services': {
      title: 'المؤذنون',
      table: {
        right: 'أدوار المؤذنين',
        left: 'تنسيق الأذان',
        tech: 'قائمة تفاعلية',
        topic: 'خدمات'
      }
    },
    'sect-gallery': {
      title: 'المعرض',
      table: {
        right: 'درون 360',
        left: 'الحرم يعرض في تجريدي',
        tech: 'خريطة متحركة تفاعلية',
        topic: 'عام'
      }
    },
    'sect-contact': {
      title: 'تواصل معنا',
      table: {
        right: 'طرق التواصل',
        left: 'معلومات الرسائل',
        tech: 'نموذج مباشر',
        topic: 'تواصل'
      }
    },
    'sect-extra-1': {
      title: 'قسم 6',
      table: {
        right: 'عرض خاص',
        left: 'محتوى موسع',
        tech: 'شبكة بيانات',
        topic: 'ملف'
      }
    },
    'sect-extra-2': {
      title: 'قسم 7',
      table: {
        right: 'مشهد ثانوي',
        left: 'مخطط بصري',
        tech: 'لوحة معلومات',
        topic: 'تجربة'
      }
    },
    'sect-extra-3': {
      title: 'قسم 8',
      table: {
        right: 'زاوية عرض',
        left: 'تقرير موجز',
        tech: 'تحليل بصري',
        topic: 'بيانات'
      }
    },
    'sect-extra-4': {
      title: 'قسم 9',
      table: {
        right: 'واجهة قصيرة',
        left: 'ملاحظات',
        tech: 'جدول تفاعلي',
        topic: 'ملخص'
      }
    },
    'sect-extra-5': {
      title: 'قسم 10',
      table: {
        right: 'نموذج جديد',
        left: 'نطاق إضافي',
        tech: 'عرض مركب',
        topic: 'أرشيف'
      }
    }
  };

  // Map sections to the 5-phase Kaaba nav in the left iframe
  const KAABA_PHASE_MAP = {
    'sect-gallery': 0,
    'sect-about': 1,
    'sect-services': 2,
    'sect-contact': 3,
    'sect-extra-1': 4,
    'sect-extra-2': 0,
    'sect-extra-3': 1,
    'sect-extra-4': 2,
    'sect-extra-5': 3,
    'sect-home': 0
  };
  const leftKaabaFrame = document.getElementById('leftKaabaFrame');
  let currentKaabaPhase = Number.isFinite(KAABA_PHASE_MAP['sect-gallery']) ? KAABA_PHASE_MAP['sect-gallery'] : 0;

  function sendKaabaPhase(phase){
    currentKaabaPhase = phase;
    if(!leftKaabaFrame || !leftKaabaFrame.contentWindow) return;
    leftKaabaFrame.contentWindow.postMessage({ type:'goToPhase', index: phase }, '*');
  }

  function syncKaabaPhase(sectionId){
    const phase = KAABA_PHASE_MAP[sectionId];
    if(!Number.isFinite(phase)) return;
    sendKaabaPhase(phase);
  }

  if(leftKaabaFrame){
    leftKaabaFrame.addEventListener('load', () => sendKaabaPhase(currentKaabaPhase));
  }

  function setDisplayContent(key){
    const data = DISPLAY_CONTENT[key] || DISPLAY_CONTENT['sect-gallery'];
    const headline = document.getElementById('displayHeadline');
    if(headline) headline.textContent = data.title;
    const rightEl = document.getElementById('tableRight');
    if(rightEl) rightEl.textContent = data.table.right;
    const leftEl = document.getElementById('tableLeft');
    if(leftEl) leftEl.textContent = data.table.left;
    const techEl = document.getElementById('tableTech');
    if(techEl) techEl.textContent = data.table.tech;
    const topicEl = document.getElementById('tableTopic');
    if(topicEl) topicEl.textContent = data.table.topic;
    const showMap = key === 'sect-gallery';
    const showKaaba = key === 'sect-extra-1';
    if(frameRight){
      frameRight.classList.toggle('show-map', showMap);
      frameRight.classList.toggle('show-kaaba', showKaaba);
    }
    if(map && showMap){
      map.resize();
    }
  }

  window.switchSection = function(id){
    document.querySelectorAll('.app-section').forEach(s => s.classList.remove('active-section'));
    const target = document.getElementById(id);
    if(target) target.classList.add('active-section');

    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    const navIdMap = {
      'sect-home':'navHome',
      'sect-about':'navAbout',
      'sect-services':'navServices',
      'sect-gallery':'navGallery',
      'sect-contact':'navContact',
      'sect-extra-1':'navExtra1',
      'sect-extra-2':'navExtra2',
      'sect-extra-3':'navExtra3',
      'sect-extra-4':'navExtra4',
      'sect-extra-5':'navExtra5'
    };
    const mNavIdMap = {
      'sect-home':'mNavHome',
      'sect-about':'mNavAbout',
      'sect-services':'mNavServices',
      'sect-gallery':'mNavGallery',
      'sect-contact':'mNavContact',
      'sect-extra-1':'mNavExtra1',
      'sect-extra-2':'mNavExtra2',
      'sect-extra-3':'mNavExtra3',
      'sect-extra-4':'mNavExtra4',
      'sect-extra-5':'mNavExtra5'
    };

    const navEl = document.getElementById(navIdMap[id]);
    if(navEl) navEl.classList.add('active');
    const mNavEl = document.getElementById(mNavIdMap[id]);
    if(mNavEl) mNavEl.classList.add('active');

    setDisplayContent(id);
    syncKaabaPhase(id);

    if(id === 'sect-gallery' && map){
      const resetZoom = window.innerWidth < 900 ? KAABA_ZOOM_MOBILE : KAABA_ZOOM_DESKTOP;
      map.flyTo({ center:KAABA_CENTER, zoom:resetZoom, pitch:KAABA_PITCH, bearing:KAABA_BEARING, duration:1800 });
    }

    if(id === 'sect-services'){
      requestAnimationFrame(() => { setupProcessAnimation(); });
    }
  };

  const safeAdd = (id, ev, handler) => {
    const el = document.getElementById(id);
    if(el) el.addEventListener(ev, handler);
  };

  safeAdd('navHome','click',() => switchSection('sect-home'));
  safeAdd('navAbout','click',() => switchSection('sect-about'));
  safeAdd('navServices','click',() => switchSection('sect-services'));
  safeAdd('navGallery','click',() => switchSection('sect-gallery'));
  safeAdd('navContact','click',() => switchSection('sect-contact'));
  safeAdd('navExtra1','click',() => switchSection('sect-extra-1'));
  safeAdd('navExtra2','click',() => switchSection('sect-extra-2'));
  safeAdd('navExtra3','click',() => switchSection('sect-extra-3'));
  safeAdd('navExtra4','click',() => switchSection('sect-extra-4'));
  safeAdd('navExtra5','click',() => switchSection('sect-extra-5'));

  safeAdd('mNavHome','click',() => switchSection('sect-home'));
  safeAdd('mNavAbout','click',() => switchSection('sect-about'));
  safeAdd('mNavServices','click',() => switchSection('sect-services'));
  safeAdd('mNavGallery','click',() => switchSection('sect-gallery'));
  safeAdd('mNavContact','click',() => switchSection('sect-contact'));
  safeAdd('mNavExtra1','click',() => switchSection('sect-extra-1'));
  safeAdd('mNavExtra2','click',() => switchSection('sect-extra-2'));
  safeAdd('mNavExtra3','click',() => switchSection('sect-extra-3'));
  safeAdd('mNavExtra4','click',() => switchSection('sect-extra-4'));
  safeAdd('mNavExtra5','click',() => switchSection('sect-extra-5'));

  const homeSliderTrack = document.querySelector('.home-illustration-track');
  const homeSliderDots = document.getElementById('homeSliderDots');
  const homeSliderArrows = document.querySelector('.home-slider-arrows');
  const getHomeSlideStep = () => {
    if(!homeSliderTrack) return 0;
    const slide = homeSliderTrack.querySelector('.home-slide');
    const base = slide ? slide.getBoundingClientRect().width : homeSliderTrack.clientWidth;
    const style = getComputedStyle(homeSliderTrack);
    const gap = parseFloat(style.columnGap || style.gap || "0") || 0;
    return base + gap;
  };
  const scrollHomeSlider = (dir) => {
    if(!homeSliderTrack) return;
    const step = getHomeSlideStep();
    if(!step) return;
    homeSliderTrack.scrollBy({ left: dir * step, behavior:'smooth' });
  };
  const setHomeActiveDot = () => {
    if(!homeSliderDots || !homeSliderTrack) return;
    const dots = Array.from(homeSliderDots.querySelectorAll('.home-dot'));
    if(!dots.length) return;
    const step = getHomeSlideStep();
    if(!step) return;
    const idx = Math.max(0, Math.min(dots.length - 1, Math.round(homeSliderTrack.scrollLeft / step)));
    dots.forEach((dot, i) => dot.classList.toggle('active', i === idx));
  };

  if(homeSliderTrack && homeSliderDots){
    homeSliderDots.addEventListener('click', (e) => {
      const btn = e.target.closest('.home-dot');
      if(!btn) return;
      const idx = Number(btn.dataset.index || 0);
      const step = getHomeSlideStep();
      if(!step) return;
      homeSliderTrack.scrollTo({ left: idx * step, behavior:'smooth' });
    });

    let dotRaf = null;
    homeSliderTrack.addEventListener('scroll', () => {
      if(dotRaf) return;
      dotRaf = requestAnimationFrame(() => {
        dotRaf = null;
        setHomeActiveDot();
      });
    }, { passive:true });
  }
  if(homeSliderTrack && homeSliderArrows){
    homeSliderArrows.addEventListener('click', (e) => {
      const btn = e.target.closest('.home-arrow');
      if(!btn) return;
      const dir = Number(btn.dataset.dir || 0);
      if(!dir) return;
      scrollHomeSlider(dir);
    });
  }
  if(homeSliderTrack){
    setInterval(() => {
      const homeSection = document.getElementById('sect-home');
      if(!homeSection || !homeSection.classList.contains('active-section')) return;
      const atEnd = homeSliderTrack.scrollLeft + homeSliderTrack.clientWidth >= homeSliderTrack.scrollWidth - 4;
      if(atEnd){
        homeSliderTrack.scrollTo({ left:0, behavior:'smooth' });
      } else {
        scrollHomeSlider(1);
      }
    }, 4000);
  }

  const form = document.getElementById('ajaxForm');
  const submitBtn = document.getElementById('formSubmitBtn');
  const successMsg = document.getElementById('formSuccess');

  if(form){
    form.addEventListener('submit', function(e){
      e.preventDefault();
      if(submitBtn){ submitBtn.textContent="Sending..."; submitBtn.style.opacity="0.7"; }
      fetch(form.action, { method:"POST", body:new FormData(form), headers:{ 'Accept':'application/json' } })
      .then(res => {
        if(res.ok){
          form.style.display="none";
          if(successMsg) successMsg.style.display="block";
        } else {
          alert("Oops! Problem submitting.");
          if(submitBtn) submitBtn.textContent="Try Again";
        }
      })
      .catch(() => {
        alert("Oops! Problem submitting.");
        if(submitBtn) submitBtn.textContent="Try Again";
      });
    });
  }

  let currentMarker = null;
  let rotationFrame = null;
  let modelSyncFrame = null;
  let activePopupProduct = null;

  const map3dPopup = document.getElementById('map3dPopup');
  const map3dInner = document.getElementById('map3dInner');

  function hideMap3D(){
    if(modelSyncFrame){ cancelAnimationFrame(modelSyncFrame); modelSyncFrame=null; }
    if(map3dInner) map3dInner.innerHTML = "";
    if(map3dPopup) map3dPopup.classList.remove('show');
    activePopupProduct = null;
  }

  function showMap3D(product){
    if(!map || !product || !product.model) return;
    activePopupProduct = product;

    const safeUrl = (product.model || "")
      .replace(/\(/g,'%28').replace(/\)/g,'%29').replace(/ /g,'%20');

    if(map3dInner){
      map3dInner.innerHTML = `
        <model-viewer
          id="popupViewer"
          src="${safeUrl}"
          camera-controls
          interaction-prompt="none"
          shadow-intensity="1"
          environment-image="neutral"
          style="background:transparent;"
          alt="${product.name || 'ثلاثي الأبعاد'}">
        </model-viewer>
      `;
    }
    if(map3dPopup) map3dPopup.classList.add('show');

    const viewer = document.getElementById('popupViewer');
    if(!viewer) return;

    let userIsInteracting = false;
    let userThetaOffsetDeg = 0;
    let userPhiDeg = 75;
    let userRadius = '4.5m';
    const baseHeadingDeg = 45;

    const parseOrbit = (orbit) => {
      if(!orbit || typeof orbit !== 'string') return null;
      const m = orbit.trim().match(/^(-?\d*\.?\d+)(deg|rad)\s+(-?\d*\.?\d+)(deg|rad)\s+([^\s]+)$/);
      if(!m) return null;
      const toDeg = (v, unit) => unit === 'rad' ? (parseFloat(v) * (180 / Math.PI)) : parseFloat(v);
      return { thetaDeg: toDeg(m[1], m[2]), phiDeg: toDeg(m[3], m[4]), radius: m[5] };
    };

    const captureUserOrbit = () => {
      const o = parseOrbit(viewer.cameraOrbit);
      if(!o) return;
      userPhiDeg = o.phiDeg;
      userRadius = o.radius;
      userThetaOffsetDeg = o.thetaDeg - (map.getBearing() + baseHeadingDeg);
    };

    viewer.addEventListener('pointerdown', () => { userIsInteracting = true; }, { passive:true });
    const endInteraction = () => { userIsInteracting = false; captureUserOrbit(); };
    viewer.addEventListener('pointerup', endInteraction, { passive:true });
    viewer.addEventListener('pointercancel', endInteraction, { passive:true });
    viewer.addEventListener('lostpointercapture', endInteraction, { passive:true });

    // ✅ Keep BOX fixed, rotate MODEL inside based on map bearing (and fix “contrary direction” by inverting)
    const sync = () => {
      if(!activePopupProduct) return;
      if(!userIsInteracting){
        const b = map.getBearing(); // Mapbox bearing increases clockwise
        const az = (b + baseHeadingDeg + userThetaOffsetDeg);
        viewer.cameraOrbit = `${az}deg ${userPhiDeg}deg ${userRadius}`;
      }
      modelSyncFrame = requestAnimationFrame(sync);
    };
    if(modelSyncFrame){ cancelAnimationFrame(modelSyncFrame); modelSyncFrame=null; }
    sync();
  }

  function gotoStore(store, productFor3D){
    if(!store || !map || !window.mapboxgl) return;

    // stop loops
    if(rotationFrame){ cancelAnimationFrame(rotationFrame); rotationFrame=null; }
    if(modelSyncFrame){ cancelAnimationFrame(modelSyncFrame); modelSyncFrame=null; }

    // hide popup until zoom finished
    hideMap3D();

    if(currentMarker) currentMarker.remove();

    const el = document.createElement('div');
    el.style.backgroundColor='#111';
    el.style.width='20px';
    el.style.height='20px';
    el.style.borderRadius='50%';
    el.style.border='2px solid white';

    currentMarker = new mapboxgl.Marker(el).setLngLat(store.coords).addTo(map);

    map.flyTo({
      center: store.coords,
      zoom: 16.5,
      pitch: 65,
      bearing: Math.random()*90,
      speed: 0.3,
      curve: 1.2,
      essential: true,
      duration: 9000
    });

    // ✅ show popup AFTER zoom finishes, then start map rotation + model sync
    map.once('moveend', () => {
      showMap3D(productFor3D);

      function rotate(){
        map.rotateTo((map.getBearing()+0.05)%360, { duration:0 });
        rotationFrame = requestAnimationFrame(rotate);
      }
      rotate();
    });
  }

  const DEFAULT_IMAGES = [
    "https://upload.wikimedia.org/wikipedia/commons/3/32/Reading_a_holy_Quran.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/5/50/Birmingham_Quran_manuscript.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/a/ac/MSSN_Gombe_High_School_Weekly_Lecture_10.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/5/5f/MSSN_Gombe_High_School_Weekly_Lecture_16.jpg"
  ];

  const VIDEO_360 = "https://raw.githubusercontent.com/lwiise/3d-models/main/Product_Video_Generation_With_Rotation.mp4";
  const VIDEO_NORMAL = "https://raw.githubusercontent.com/lwiise/3d-models/main/Artistic_Video_Generation_Request.mp4";

  function buildMediaTabs(active){
    const tabs = [
      { key:'images', label:'الصور' },
      { key:'v360', label:'٣٦٠°' },
      { key:'video', label:'فيديو' },
      { key:'d3', label:'ثلاثي الأبعاد' }
    ];
    return `
      <div class="media-tabs" id="mediaTabs">
        ${tabs.map(t => `
          <button class="media-tab ${t.key===active?'active':''}" data-tab="${t.key}">${t.label}</button>
        `).join('')}
      </div>
    `;
  }

  function renderImages(images){
    let idx = 0;
    const html = `
      <img id="imgSlide" src="${images[0]}" alt="صورة" />
      <button class="img-arrow left" id="imgPrev">&lsaquo;</button>
      <button class="img-arrow right" id="imgNext">&rsaquo;</button>
    `;
    return { html, mount: (container) => {
      const img = container.querySelector('#imgSlide');
      const prev = container.querySelector('#imgPrev');
      const next = container.querySelector('#imgNext');
      const show = () => { if(img) img.src = images[idx]; };
      if(prev) prev.onclick = () => { idx = (idx - 1 + images.length) % images.length; show(); };
      if(next) next.onclick = () => { idx = (idx + 1) % images.length; show(); };
    }};
  }

  function render360(){
    const html = `
      <video id="v360" src="${VIDEO_360}" playsinline preload="metadata"></video>
      <div class="v360-ui">
        <button class="v360-btn" id="v360Toggle">II</button>
        <input class="v360-range" id="v360Range" type="range" min="0" max="1000" value="0" />
      </div>
    `;
    return { html, mount: (container) => {
      const v = container.querySelector('#v360');
      const btn = container.querySelector('#v360Toggle');
      const range = container.querySelector('#v360Range');
      if(!v || !btn || !range) return;
      v.controls = false;
      v.loop = true;
      v.muted = true;
      v.play().catch(()=>{});
      const syncRange = () => {
        if(!v.duration || !isFinite(v.duration)) return;
        range.value = Math.floor((v.currentTime / v.duration) * 1000);
      };
      v.addEventListener('timeupdate', syncRange);
      range.addEventListener('input', () => {
        if(!v.duration || !isFinite(v.duration)) return;
        const t = (parseInt(range.value,10)/1000) * v.duration;
        v.currentTime = t;
      });
      btn.addEventListener('click', () => {
        if(v.paused){
          v.play().catch(()=>{});
          btn.textContent = "II";
        }else{
          v.pause();
          btn.textContent = "▶";
        }
      });
    }};
  }

  function renderVideo(){
    const html = `<video src="${VIDEO_NORMAL}" controls playsinline preload="metadata"></video>`;
    return { html, mount: ()=>{} };
  }

  function render3D(modelUrl, fallbackImg, productName){
    const safeUrl = (modelUrl || "").replace(/\(/g,'%28').replace(/\)/g,'%29').replace(/ /g,'%20');
    const html = `
      <model-viewer
        id="viewer3d"
        src="${safeUrl}"
        camera-controls
        auto-rotate
        shadow-intensity="1"
        style="background:transparent; width:100%; height:100%;"
        camera-orbit="45deg 75deg 4.5m"
        environment-image="neutral"
        alt="${productName || 'ثلاثي الأبعاد'}">
      </model-viewer>
    `;
    return { html, mount: (container) => {
      const viewer = container.querySelector('#viewer3d');
      if(viewer){
        viewer.addEventListener('error', () => {
          container.innerHTML = `<img src="${fallbackImg}" alt="Fallback" />`;
        });
      }
    }};
  }

  function renderActiveMedia(p, tabKey){
    const soloMedia = document.getElementById("soloMedia");
    const soloTabs = document.getElementById("soloTabs");
    if(!soloMedia || !soloTabs) return;

    soloTabs.innerHTML = buildMediaTabs(tabKey);

    let pack;
    if(tabKey === 'images') pack = renderImages(p.images || DEFAULT_IMAGES);
    if(tabKey === 'v360') pack = render360();
    if(tabKey === 'video') pack = renderVideo();
    if(tabKey === 'd3') pack = render3D(p.model, (p.images && p.images[0]) ? p.images[0] : p.img, p.name);

    soloMedia.innerHTML = pack.html;
    pack.mount(soloMedia);

    attachTabHandlers(p);
  }

  function attachTabHandlers(p){
    const soloTabs = document.getElementById("soloTabs");
    if(!soloTabs) return;

    const tabs = soloTabs.querySelector('#mediaTabs');
    if(!tabs) return;

    if(tabs.dataset.bound === "1") return;
    tabs.dataset.bound = "1";

    tabs.addEventListener('click', (e) => {
      const btn = e.target.closest('.media-tab');
      if(!btn) return;
      const tab = btn.dataset.tab;
      renderActiveMedia(p, tab);
    });
  }

  // عناصر المعرض
  const PRODUCTS = [
    {
      id:"item-1",
      name:"حلقة قرآنية",
      category:"halaqat-quran",
      img:"https://upload.wikimedia.org/wikipedia/commons/3/32/Reading_a_holy_Quran.jpg",
      images:[
        "https://upload.wikimedia.org/wikipedia/commons/3/32/Reading_a_holy_Quran.jpg"
      ],
      model:"https://raw.githubusercontent.com/lwiise/3d-models/main/base%20(5).glb",
      specs:{ mat:"تلاوة وحفظ", dim:"حلقة يومية" },
      store:{ name:"مسجد الحي - الرياض", coords:[46.6753,24.7136] },
      artist:{ name:"مشرف الحلقة", role:"معلم قرآن", img:"https://images.unsplash.com/photo-1500648767791-00dcc994a43e?auto=format&fit=crop&w=100&q=80", bio:"يشرف على المتابعة والتصحيح ويغرس آداب التلاوة والتعلم." }
    },
    {
      id:"item-2",
      name:"مصحف تاريخي",
      category:"mushaf",
      img:"https://upload.wikimedia.org/wikipedia/commons/5/50/Birmingham_Quran_manuscript.jpg",
      images:[
        "https://upload.wikimedia.org/wikipedia/commons/5/50/Birmingham_Quran_manuscript.jpg"
      ],
      model:"https://raw.githubusercontent.com/lwiise/3d-models/main/base%20(7).glb",
      specs:{ mat:"مصحف مخطوط", dim:"تراث محفوظ" },
      store:{ name:"مكتبة تراثية - القاهرة", coords:[31.2357,30.0444] },
      artist:{ name:"أمين المخطوطات", role:"باحث تراث", img:"https://images.unsplash.com/photo-1494790108377-be9c29b29330?auto=format&fit=crop&w=100&q=80", bio:"يحافظ على المخطوطات ويوثق تاريخها ومسارها العلمي." }
    },
    {
      id:"item-3",
      name:"حلقة علمية",
      category:"halaqat-ilm",
      img:"https://upload.wikimedia.org/wikipedia/commons/a/ac/MSSN_Gombe_High_School_Weekly_Lecture_10.jpg",
      images:[
        "https://upload.wikimedia.org/wikipedia/commons/a/ac/MSSN_Gombe_High_School_Weekly_Lecture_10.jpg"
      ],
      model:"https://raw.githubusercontent.com/lwiise/3d-models/main/base%20(6).glb",
      specs:{ mat:"فقه وتفسير", dim:"برنامج أسبوعي" },
      store:{ name:"مركز علمي - المدينة", coords:[39.5692,24.5247] },
      artist:{ name:"مدير الحلقة", role:"مدرس شرعي", img:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?auto=format&fit=crop&w=100&q=80", bio:"ينسق الدروس ويربط الطلاب بمتون العلم وفهم المقاصد." }
    },
    {
      id:"item-4",
      name:"درس أسبوعي",
      category:"durus",
      img:"https://upload.wikimedia.org/wikipedia/commons/5/5f/MSSN_Gombe_High_School_Weekly_Lecture_16.jpg",
      images:[
        "https://upload.wikimedia.org/wikipedia/commons/5/5f/MSSN_Gombe_High_School_Weekly_Lecture_16.jpg"
      ],
      model:"https://raw.githubusercontent.com/lwiise/3d-models/main/compressed_1764071266806_base%20(15).glb",
      specs:{ mat:"مجلس وعظ", dim:"درس عام" },
      store:{ name:"جامع رئيسي - جدة", coords:[39.1979,21.4858] },
      artist:{ name:"محاضر الدرس", role:"داعية وخطيب", img:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?auto=format&fit=crop&w=100&q=80", bio:"يقدم دروسًا منهجية تبني الوعي وترسخ القيم." }
    }
  ];

  const grid = document.getElementById("grid");

  function render(list){
    if(!grid) return;
    grid.innerHTML = "";
    list.forEach(p => {
      const el = document.createElement("article");
      el.className = "card";
      el.innerHTML = `
        <div class="card-media"><img src="${p.img}" alt="${p.name}"/></div>
        <div class="card-name">${p.name}</div>
        <div class="card-sub">سلسلة ٢٠٢٤</div>
      `;
      el.addEventListener("click", () => openSolo(p));
      grid.appendChild(el);
    });
  }

  const filtersEl = document.getElementById("filters");
  if(filtersEl){
    filtersEl.addEventListener("click", e => {
      const btn = e.target.closest(".chip");
      if(!btn) return;
      document.querySelectorAll(".chip").forEach(c => c.classList.remove("active"));
      btn.classList.add("active");
      const f = btn.dataset.filter;
      render(f === "all" ? PRODUCTS : PRODUCTS.filter(p => p.category === f));
    });
  }

  let soloSelectedColor = "أحمر";
  let soloSelectedSize = "متوسط";

  function syncSoloSelections(){
    const setActive = (selector, attr, value) => {
      document.querySelectorAll(selector).forEach(el => {
        const v = el.getAttribute(attr);
        el.classList.toggle('active', !!value && v === value);
      });
    };
    setActive('#soloColorPopover .solo-suboption', 'data-color', soloSelectedColor);
    setActive('#soloConfigColors .solo-config-option', 'data-color', soloSelectedColor);
    setActive('#soloSizePopover .solo-suboption', 'data-size', soloSelectedSize);
    setActive('#soloConfigSizes .solo-config-option', 'data-size', soloSelectedSize);

    const summary = document.getElementById('soloConfigSummary');
    if(summary) summary.textContent = `الاختيار: ${soloSelectedColor || '--'} / ${soloSelectedSize || '--'}`;
  }

  function setSoloOptionPopover(panel){
    const colorPop = document.getElementById('soloColorPopover');
    const sizePop = document.getElementById('soloSizePopover');
    const colorBtn = document.getElementById('soloColorBtn');
    const sizeBtn = document.getElementById('soloSizeBtn');

    const showColor = panel === 'color';
    const showSize = panel === 'size';

    if(colorPop) colorPop.hidden = !showColor;
    if(sizePop) sizePop.hidden = !showSize;

    if(colorBtn){
      colorBtn.classList.toggle('active', showColor);
      colorBtn.setAttribute('aria-expanded', showColor ? 'true' : 'false');
    }
    if(sizeBtn){
      sizeBtn.classList.toggle('active', showSize);
      sizeBtn.setAttribute('aria-expanded', showSize ? 'true' : 'false');
    }
  }

  function setSoloCustomizerOpen(isOpen){
    const frame = document.querySelector('#sect-gallery.solo .solo-frame');
    if(frame) frame.classList.toggle('customize-open', isOpen);

    const btn = document.getElementById('soloCustomsBtn');
    if(btn){
      btn.classList.toggle('active', isOpen);
      btn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
    }

    const cfg = document.getElementById('soloConfig');
    if(cfg) cfg.setAttribute('aria-hidden', isOpen ? 'false' : 'true');
  }

  function setSoloInfoOpen(isOpen){
    const frame = document.querySelector('#sect-gallery.solo .solo-frame');
    if(frame) frame.classList.toggle('info-open', isOpen);

    const btn = document.getElementById('soloInfoBtn');
    if(btn){
      btn.classList.toggle('active', isOpen);
      btn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
    }

    const card = document.getElementById('soloInfoCard');
    if(card) card.setAttribute('aria-hidden', isOpen ? 'false' : 'true');
  }

  function openSolo(p){
    document.getElementById("shop").classList.add("solo");
    document.getElementById("sect-gallery").classList.add("solo");

    setSoloInfoOpen(false);
    setSoloOptionPopover(null);
    setSoloCustomizerOpen(false);
    soloSelectedColor = "أحمر";
    soloSelectedSize = "متوسط";
    syncSoloSelections();

    const soloName = document.getElementById("soloName");
    if(soloName) soloName.textContent = p.name;

    const soloFootTitle = document.getElementById("soloFootTitle");
    if(soloFootTitle) soloFootTitle.textContent = p.name.toUpperCase();

    document.getElementById("soloTitle").textContent = p.name.toUpperCase();
    document.getElementById("soloStore").textContent = p.store.name;
    document.getElementById("spMat").textContent = p.specs.mat;
    document.getElementById("spDim").textContent = p.specs.dim;

    const soloInfoName = document.getElementById("soloInfoName");
    if(soloInfoName) soloInfoName.textContent = p.name.toUpperCase();
    const soloInfoLoc = document.getElementById("soloInfoLoc");
    if(soloInfoLoc) soloInfoLoc.textContent = p.store.name;
    const soloInfoMat = document.getElementById("soloInfoMat");
    if(soloInfoMat) soloInfoMat.textContent = p.specs.mat;
    const soloInfoDim = document.getElementById("soloInfoDim");
    if(soloInfoDim) soloInfoDim.textContent = p.specs.dim;

    document.getElementById("artistName").textContent = p.artist.name;
    document.getElementById("artistRole").textContent = p.artist.role;
    document.getElementById("artistImg").src = p.artist.img;

    document.getElementById("modalArtistName").textContent = p.artist.name;
    document.getElementById("modalArtistRole").textContent = p.artist.role;
    document.getElementById("modalArtistImg").src = p.artist.img;
    document.getElementById("modalArtistBio").textContent = p.artist.bio;

    const fs = document.getElementById("formالموضوع");
    if(fs) fs.value = "Inquiry: " + p.name;

    const sideNav = document.querySelector('.side-nav');
    if(sideNav) sideNav.classList.add('focused');

    renderActiveMedia(p, 'images');

    // ✅ zoom + then show 3D popup after moveend
    gotoStore(p.store, p);
  }

  function closeSolo(){
    setSoloInfoOpen(false);
    setSoloOptionPopover(null);
    setSoloCustomizerOpen(false);

    const shopEl = document.getElementById("shop");
    const galleryEl = document.getElementById("sect-gallery");
    if(shopEl) shopEl.classList.remove("solo");
    if(galleryEl) galleryEl.classList.remove("solo");

    const sideNav = document.querySelector('.side-nav');
    if(sideNav) sideNav.classList.remove('focused');

    hideMap3D();

    if(rotationFrame){ cancelAnimationFrame(rotationFrame); rotationFrame=null; }

    if(map){
      const isMobileReset = window.innerWidth < 900;
      const resetZoom = isMobileReset ? KAABA_ZOOM_MOBILE : KAABA_ZOOM_DESKTOP;
      map.flyTo({ center:KAABA_CENTER, zoom:resetZoom, pitch:KAABA_PITCH, bearing:KAABA_BEARING, duration:2200 });
    }
  }

  safeAdd("btnBack","click",closeSolo);
  safeAdd("btnClose","click",closeSolo);
  safeAdd("btnContactProduct","click",() => switchSection('sect-contact'));

  safeAdd("soloInfoBtn","click", () => {
    const frame = document.querySelector('#sect-gallery.solo .solo-frame');
    if(!frame) return;
    setSoloOptionPopover(null);
    setSoloCustomizerOpen(false);
    setSoloInfoOpen(!frame.classList.contains('info-open'));
  });
  safeAdd("soloInfoClose","click", () => setSoloInfoOpen(false));

  safeAdd("soloColorBtn","click", () => {
    setSoloInfoOpen(false);
    setSoloCustomizerOpen(false);
    const colorBtn = document.getElementById('soloColorBtn');
    if(!colorBtn) return;
    setSoloOptionPopover(colorBtn.classList.contains('active') ? null : 'color');
  });

  safeAdd("soloSizeBtn","click", () => {
    setSoloInfoOpen(false);
    setSoloCustomizerOpen(false);
    const sizeBtn = document.getElementById('soloSizeBtn');
    if(!sizeBtn) return;
    setSoloOptionPopover(sizeBtn.classList.contains('active') ? null : 'size');
  });

  safeAdd("soloCustomsBtn","click", () => {
    const frame = document.querySelector('#sect-gallery.solo .solo-frame');
    if(!frame) return;
    setSoloInfoOpen(false);
    setSoloOptionPopover(null);
    setSoloCustomizerOpen(!frame.classList.contains('customize-open'));
  });
  safeAdd("soloConfigClose","click", () => setSoloCustomizerOpen(false));

  const soloColorPopover = document.getElementById('soloColorPopover');
  if(soloColorPopover && soloColorPopover.dataset.bound !== "1"){
    soloColorPopover.dataset.bound = "1";
    soloColorPopover.addEventListener('click', (e) => {
      const btn = e.target.closest('.solo-suboption');
      if(!btn) return;
      const color = btn.getAttribute('data-color');
      if(color) soloSelectedColor = color;
      syncSoloSelections();
      setSoloOptionPopover(null);
    });
  }

  const soloSizePopover = document.getElementById('soloSizePopover');
  if(soloSizePopover && soloSizePopover.dataset.bound !== "1"){
    soloSizePopover.dataset.bound = "1";
    soloSizePopover.addEventListener('click', (e) => {
      const btn = e.target.closest('.solo-suboption');
      if(!btn) return;
      const size = btn.getAttribute('data-size');
      if(size) soloSelectedSize = size;
      syncSoloSelections();
      setSoloOptionPopover(null);
    });
  }

  const soloConfig = document.getElementById('soloConfig');
  if(soloConfig && soloConfig.dataset.bound !== "1"){
    soloConfig.dataset.bound = "1";
    soloConfig.addEventListener('click', (e) => {
      const btn = e.target.closest('.solo-config-option');
      if(!btn) return;
      const color = btn.getAttribute('data-color');
      const size = btn.getAttribute('data-size');
      if(color) soloSelectedColor = color;
      if(size) soloSelectedSize = size;
      syncSoloSelections();
    });
  }

  const modalArtist = document.getElementById("modalArtistOverlay");
  const artistBtnEl = document.getElementById("artistBtn");
  if(artistBtnEl) artistBtnEl.addEventListener("click", () => modalArtist && modalArtist.classList.add("open"));
  safeAdd("closeArtistModal","click", () => modalArtist && modalArtist.classList.remove("open"));
  window.addEventListener("click", (e) => { if(e.target === modalArtist) modalArtist.classList.remove("open"); });

  function setupProcessAnimation(){
    const grids = Array.from(document.querySelectorAll(".process-grid"));
    if(!grids.length) return;

    grids.forEach((grid) => {
      if(grid.dataset.procLoop === "1") return;

      const rail = grid.querySelector(".proc-rail");
      const line = rail ? rail.querySelector(".proc-line") : null;
      const dot = rail ? rail.querySelector(".proc-dot") : null;
      const itemsWrap = grid.querySelector(".proc-items");
      const steps = itemsWrap ? Array.from(itemsWrap.querySelectorAll(".proc-step")) : [];
      if(!dot || !itemsWrap || !rail || !line || !steps.length) return;

      const scroller = grid.closest(".section-scroll");
      if(!scroller) return;

      const section = grid.closest(".app-section");

      let minY = 0;
      let maxY = 0;

      const isWindowScroll = () => {
        const style = getComputedStyle(scroller);
        const overflowY = style.overflowY;
        const scrollable = scroller.scrollHeight > scroller.clientHeight + 1;
        return !scrollable || overflowY === "visible";
      };

      const clamp01 = (v) => Math.max(0, Math.min(1, v));

      const computeGeometry = () => {
        rail.style.height = itemsWrap.offsetHeight + "px";

        const railRect = rail.getBoundingClientRect();
        const centers = steps.map(step => {
          const rect = step.getBoundingClientRect();
          return (rect.top + (rect.height / 2)) - railRect.top;
        });
        if(centers.length < 2) return;

        minY = Math.min(...centers);
        maxY = Math.max(...centers);

        line.style.top = `${minY}px`;
        line.style.height = `${Math.max(0, (maxY - minY))}px`;
        line.style.bottom = "auto";
      };

      const getViewportCenter = () => {
        if(isWindowScroll()) return window.innerHeight / 2;
        const rect = scroller.getBoundingClientRect();
        return rect.top + (scroller.clientHeight / 2);
      };

      const moveDot = () => {
        const viewportCenter = getViewportCenter();
        const wrapRect = itemsWrap.getBoundingClientRect();
        const progress = clamp01((viewportCenter - wrapRect.top) / Math.max(1, wrapRect.height));
        const y = minY + (maxY - minY) * progress;
        dot.style.top = `${y}px`;
      };

      let raf = null;
      const onScroll = () => {
        if(raf) return;
        raf = requestAnimationFrame(() => {
          raf = null;
          computeGeometry();
          moveDot();
        });
      };

      requestAnimationFrame(() => {
        computeGeometry();
        moveDot();
      });

      scroller.addEventListener("scroll", onScroll, { passive:true });
      window.addEventListener("scroll", onScroll, { passive:true });
      document.addEventListener("scroll", onScroll, { passive:true });
      window.addEventListener("touchmove", onScroll, { passive:true });
      window.addEventListener("resize", () => {
        computeGeometry();
        moveDot();
      });

      grid.dataset.procLoop = "1";

      const tick = () => {
        const isVisible = section ? section.offsetParent !== null : true;
        if(isVisible){
          computeGeometry();
          moveDot();
        }
        requestAnimationFrame(tick);
      };
      requestAnimationFrame(tick);
    });
  }

  (function init(){
    // عرض كل العناصر عند البداية
    render(PRODUCTS);

    // Default active nav = Gallery
    switchSection('sect-gallery');

    setupProcessAnimation();
  })();
</script>
</body>
</html>








